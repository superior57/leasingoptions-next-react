{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport accounting from 'accounting';\nimport { loadStripe } from '@stripe/stripe-js';\nimport style from './checkout-form.module.scss';\nimport Link from 'next/link';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faCreditCard } from \"@fortawesome/pro-regular-svg-icons\";\nimport { faShieldCheck } from \"@fortawesome/pro-regular-svg-icons\";\nimport { faCcApplePay } from \"@fortawesome/free-brands-svg-icons\";\nimport { faCcVisa } from \"@fortawesome/free-brands-svg-icons\";\nimport { faCcMastercard } from \"@fortawesome/free-brands-svg-icons\";\nimport { faLock } from \"@fortawesome/free-solid-svg-icons\";\nimport { faArrowLeft } from \"@fortawesome/free-solid-svg-icons\";\nimport { PaymentsAPI } from 'API/PaymentsAPI';\n\nconst CheckoutForm = () => {\n  const stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLIC_KEY);\n  const {\n    0: succeeded,\n    1: setSucceeded\n  } = useState(false);\n  const {\n    0: cancelled,\n    1: setCancelled\n  } = useState(false);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  const {\n    0: initializing,\n    1: setInitializing\n  } = useState(false);\n  const {\n    0: paymentRequired,\n    1: setPaymentRequired\n  } = useState(null);\n  const {\n    0: isExtension,\n    1: setIsExtension\n  } = useState(false);\n  const {\n    0: vehicle,\n    1: setVehicle\n  } = useState(null);\n  const {\n    0: depositAmount,\n    1: setDepositAmount\n  } = useState(0);\n  const {\n    0: orderNumber,\n    1: setOrderNumber\n  } = useState(null);\n  const {\n    0: sessionId,\n    1: setSessionId\n  } = useState(null);\n  const router = useRouter();\n  useEffect(() => {\n    const queryParams = new URLSearchParams(window.location.search);\n    let paymentSuccess = queryParams.get(\"success\") === \"1\";\n    let paymentCancelled = queryParams.get(\"cancelled\") === \"1\";\n    setSucceeded(paymentSuccess);\n    setCancelled(paymentCancelled);\n\n    if (!paymentCancelled) {\n      const paymentIntentRequest = {\n        orderId: router.query.orderid || queryParams.get(\"orderid\"),\n        type: router.query.type || queryParams.get(\"type\"),\n        amount: parseFloat(router.query.amount || queryParams.get(\"amount\")),\n        extension: (router.query.extension || queryParams.get(\"extension\")) === \"1\",\n        hostOrigin: window.location.href\n      };\n      setInitializing(true); //retrieve checkout session ID\n\n      PaymentsAPI.CreateCheckoutSession(paymentIntentRequest).then(function (result) {\n        if (result.status.code === 0) {\n          if (result.data.uniqueId) {\n            setPaymentRequired(result.data.paymentIsRequired);\n            setIsExtension(result.data.extension);\n            setVehicle(result.data.vehicle);\n            setDepositAmount(result.data.depositAmount);\n            setOrderNumber(result.data.manualOrderId || result.data.orderName);\n            setSessionId(result.data.uniqueId);\n          } else {\n            setError(\"Payment initialization failed.\");\n            setSucceeded(false);\n          }\n\n          setInitializing(false);\n        }\n      });\n    } //Do not show a payment form again\n\n\n    if (paymentSuccess || paymentCancelled) {\n      setPaymentRequired(false);\n    }\n  }, []);\n\n  const handleCheckoutClick = async event => {\n    const stripe = await stripePromise; // When the customer clicks on the button, redirect them to Checkout.\n\n    const result = await stripe.redirectToCheckout({\n      sessionId: sessionId\n    });\n\n    if (result.error) {\n      setError(`Payment Failed. ${result.error.message}`);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"section\", {\n      className: `${style[\"payment-header\"]}`,\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"container text-center\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-md-24 py-md-5\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: style[\"icon\"],\n              children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                icon: faLock,\n                className: \"fa-lock\"\n              })\n            }), /*#__PURE__*/_jsx(\"h1\", {\n              children: \"Secure Online Payment\"\n            })]\n          })\n        })\n      })\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: \"container-fluid py-3\",\n      children: [!initializing && /*#__PURE__*/_jsx(\"div\", {\n        className: `container py-3 py-md-5`,\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: style[\"checkout-container\"],\n          children: [succeeded && /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"col-24 text-center\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: `d-flex justify-content-center align-items-center ${style[\"title\"]}`,\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                    icon: faShieldCheck\n                  })\n                }), /*#__PURE__*/_jsx(\"h2\", {\n                  children: \"Thank you for your order\"\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: `col-md-14 col-24 ${style[\"payment-form\"]}`,\n                  children: [/*#__PURE__*/_jsxs(\"p\", {\n                    children: [\"Your payment reference is: \", /*#__PURE__*/_jsx(\"strong\", {\n                      children: orderNumber\n                    })]\n                  }), /*#__PURE__*/_jsx(Link, {\n                    passHref: true,\n                    href: \"/\",\n                    children: /*#__PURE__*/_jsxs(\"a\", {\n                      className: \"btn btn-primary btn-labeled btn-lg\",\n                      children: [/*#__PURE__*/_jsx(\"span\", {\n                        className: \"btn-label\",\n                        children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                          width: \"17\",\n                          height: \"17\",\n                          icon: faArrowLeft\n                        })\n                      }), /*#__PURE__*/_jsx(\"span\", {\n                        className: \"btn-text\",\n                        children: \"Back to home\"\n                      })]\n                    })\n                  })]\n                })\n              })]\n            })\n          }), cancelled && /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24\",\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"alert alert-warning\",\n                role: \"alert\",\n                children: /*#__PURE__*/_jsx(\"strong\", {\n                  children: \"Your payment was cancelled\"\n                })\n              })\n            })\n          }), !succeeded && !cancelled && /*#__PURE__*/_jsxs(_Fragment, {\n            children: [paymentRequired === true && /*#__PURE__*/_jsxs(_Fragment, {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 text-center\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: `d-flex justify-content-center align-items-center ${style[\"title\"]}`,\n                    children: [/*#__PURE__*/_jsx(\"div\", {\n                      children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                        icon: faCreditCard\n                      })\n                    }), /*#__PURE__*/_jsx(\"h2\", {\n                      children: \"Payment Checkout\"\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"p\", {\n                    children: [\"A payment of \", /*#__PURE__*/_jsx(\"strong\", {\n                      dangerouslySetInnerHTML: {\n                        __html: accounting.formatMoney(depositAmount, \"&pound;\")\n                      }\n                    }), \"\\xA0is required to enable us to \", isExtension ? \"process your extension\" : \"order the vehicle and progress your order\"]\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: \"row\",\n                    children: /*#__PURE__*/_jsxs(\"div\", {\n                      className: `col-md-14 col-24 ${style[\"payment-form\"]}`,\n                      children: [/*#__PURE__*/_jsx(\"p\", {\n                        children: /*#__PURE__*/_jsx(\"strong\", {\n                          children: vehicle\n                        })\n                      }), /*#__PURE__*/_jsxs(\"button\", {\n                        disabled: succeeded,\n                        id: \"submit\",\n                        type: \"submit\",\n                        className: \"btn btn-primary btn-labeled btn-lg btn-block-sm\",\n                        onClick: evt => {\n                          handleCheckoutClick(evt);\n                        },\n                        children: [/*#__PURE__*/_jsx(\"span\", {\n                          className: \"btn-label\",\n                          children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                            width: \"17\",\n                            height: \"17\",\n                            icon: faLock\n                          })\n                        }), /*#__PURE__*/_jsxs(\"span\", {\n                          className: \"btn-text\",\n                          children: [\"Pay \", /*#__PURE__*/_jsx(\"strong\", {\n                            dangerouslySetInnerHTML: {\n                              __html: accounting.formatMoney(depositAmount, \"&pound;\")\n                            }\n                          }), \" Now\"]\n                        })]\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: style[\"payment-methods\"],\n                        children: /*#__PURE__*/_jsxs(\"div\", {\n                          className: `d-flex justify-content-between ${style[\"wrapper\"]}`,\n                          children: [/*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcApplePay\n                            })\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcVisa\n                            })\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcMastercard\n                            })\n                          })]\n                        })\n                      })]\n                    })\n                  })]\n                })\n              }), error && /*#__PURE__*/_jsx(\"div\", {\n                className: \"row mt-3\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"col-24 col-lg-14\",\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \"alert alert-danger\",\n                    role: \"alert\",\n                    children: error\n                  })\n                })\n              })]\n            }), paymentRequired === false && /*#__PURE__*/_jsx(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"col-24 text-center\",\n                children: [/*#__PURE__*/_jsx(\"h2\", {\n                  children: \"Secure Online payment - No payment required\"\n                }), /*#__PURE__*/_jsx(\"p\", {\n                  children: \"Thanks for your order.\"\n                })]\n              })\n            })]\n          })]\n        })\n      }), initializing && /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 text-center my-5\",\n          children: /*#__PURE__*/_jsx(\"h3\", {\n            children: \"Payment is being initialized. Please wait....\"\n          })\n        })\n      })]\n    })]\n  });\n};\n\nexport default CheckoutForm;","map":null,"metadata":{},"sourceType":"module"}