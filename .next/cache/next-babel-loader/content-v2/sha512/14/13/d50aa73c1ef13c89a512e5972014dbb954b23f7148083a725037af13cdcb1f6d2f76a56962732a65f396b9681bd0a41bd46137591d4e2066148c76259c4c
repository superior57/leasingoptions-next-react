{"ast":null,"code":"import _defineProperty from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _objectWithoutProperties from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport { connect } from 'react-redux';\nimport accounting from 'accounting';\nimport Modal from 'react-bootstrap/Modal';\nimport { useForm, FormContext } from \"react-hook-form\";\nimport style from './px.module.scss';\nimport { setPrivacyAccepted } from 'helpers/cookiesHelper';\nimport { EnquiryService } from \"business-logic/enquiryService\";\nimport { ValueYourCarService } from \"business-logic/valueYourCarService\";\nimport { MarketingCommunicationsService } from 'business-logic/marketingCommunicationsService';\nimport { VehicleTypes } from 'enums/VehicleTypes';\nimport { ValuationEnquiry } from \"types/enquiry/ValuationEnquiry\";\nimport { PhoneNumberIsValid, EmailAddressIsValid } from 'helpers/validation';\nimport { getGAClientId } from 'helpers/analytics';\nimport ModalContext from 'components/HOCs/modal/modalContext';\nimport MarketingConsent from 'components/marketing-consent';\nimport PrivacyPolicyConsent from 'components/privacy-policy-consent';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSpinner } from \"@fortawesome/pro-regular-svg-icons\";\nimport Search from 'components/search';\nimport { GetThankYouPageUrl } from 'helpers/urlHelper';\nimport { useRouter } from 'next/router';\nimport { GetSalesPeople } from 'business-logic/systemService';\nimport { GetModels } from 'business-logic/vehicleService';\n\nfunction mapStateToProps(state) {\n  return {\n    carManufacturerList: state.carManufacturerList\n  };\n}\n\nvar ModalPartExchange = function ModalPartExchange(_ref) {\n  var _errors$mileage, _errors$email, _errors$telephone;\n\n  var isInternal = _ref.isInternal,\n      onRequestClose = _ref.onRequestClose,\n      _ref$registration = _ref.registration,\n      registration = _ref$registration === void 0 ? '' : _ref$registration,\n      carManufacturerList = _ref.carManufacturerList,\n      otherProps = _objectWithoutProperties(_ref, [\"isInternal\", \"onRequestClose\", \"registration\", \"carManufacturerList\"]);\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setIsLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      marketingConsentIsVerifying = _useState2[0],\n      setMarketingConsentIsVerifying = _useState2[1];\n\n  var _useState3 = useState(null),\n      emailAddressConsent = _useState3[0],\n      setEmailAddressConsent = _useState3[1];\n\n  var router = useRouter();\n\n  var _useState4 = useState([]),\n      modelsList = _useState4[0],\n      setModelsList = _useState4[1];\n\n  var _useState5 = useState(null),\n      selectedMake = _useState5[0],\n      setSelectedMake = _useState5[1];\n\n  var _useState6 = useState([]),\n      salesPeopleList = _useState6[0],\n      setSalesPeopleList = _useState6[1];\n\n  var _useState7 = useState(null),\n      valuationData = _useState7[0],\n      setValuationData = _useState7[1]; //used later to close current dialog and open searh\n\n\n  var modalContext = useContext(ModalContext);\n  var methods = useForm();\n  var register = methods.register,\n      handleSubmit = methods.handleSubmit,\n      errors = methods.errors;\n  useEffect(function () {\n    GetSalesPeople().then(function (result) {\n      setSalesPeopleList(result.data);\n    })[\"catch\"](function (error) {\n      console.log(error);\n    });\n  }, []);\n  useEffect(function () {\n    if (selectedMake) {\n      GetModels(VehicleTypes.Car, selectedMake).then(function (data) {\n        setModelsList(data.data);\n      });\n    } else {\n      setModelsList([]);\n    }\n  }, [selectedMake]);\n\n  var onMakeSelected = function onMakeSelected(evt) {\n    setSelectedMake(evt.target.value);\n  }; //Fires only when input loses focus and triggers marketing-consent to reinitialize\n\n\n  var onEmailFocusOut = function onEmailFocusOut(event) {\n    if (!isInternal) {\n      if (event.target.value && EmailAddressIsValid(event.target.value)) {\n        setEmailAddressConsent(event.target.value);\n      } else {\n        setEmailAddressConsent(null);\n      }\n    }\n  };\n\n  var handleSearchClick = function handleSearchClick(evt) {\n    modalContext.hideModal();\n    modalContext.showModal(Search, {\n      show: true,\n      title: \"Start Your Search\"\n    });\n  };\n\n  var onSubmit = function onSubmit(data) {\n    setIsLoading(false);\n\n    if (!isLoading && !marketingConsentIsVerifying) {\n      setIsLoading(true); //Send valuation request\n\n      var request = {\n        vrm: data.vrm,\n        mileage: data.mileage,\n        fullName: data.fullName,\n        telephone: data.telephone,\n        email: data.email,\n        postCode: data.postCode\n      };\n      var promise = new Promise(function (resolve) {\n        ValueYourCarService.GetValuation(request).then(function (valuationResult) {\n          var _valuationResult$data;\n\n          if (valuationResult !== null && valuationResult !== void 0 && (_valuationResult$data = valuationResult.data) !== null && _valuationResult$data !== void 0 && _valuationResult$data.id) {\n            setValuationData(valuationResult.data);\n            var communicationTypes = null; //Should check if form was visible or user did any updates to those fields\n            //If no form is displayed data.contactEmail and other checkbox properties are \"undefined\"\n\n            if (!isInternal && data.contactEmail != undefined && data.allowedCommunicationTypes) {\n              communicationTypes = data.allowedCommunicationTypes;\n            }\n\n            var enquiry = new ValuationEnquiry();\n            enquiry.vrm = data.vrm;\n            enquiry.mileage = data.mileage;\n            enquiry.fullName = data.fullName;\n            enquiry.telephone = data.telephone;\n            enquiry.email = data.email;\n            enquiry.postCode = data.postCode;\n            enquiry.allowedCommunicationTypes = communicationTypes;\n            enquiry.valuationCap = valuationResult.data.cap;\n            enquiry.valuationId = valuationResult.data.id;\n            enquiry.valuationValue = valuationResult.data.value;\n            enquiry.make = data.make.replace(\"-\", \" \");\n            enquiry.model = data.model.replace(\"-\", \" \");\n            enquiry.salesPersonId = isInternal ? data.salesPersonId : null;\n            enquiry.gaClientId = getGAClientId();\n            EnquiryService.SubmitValuationEnquiry(enquiry).then(function (result) {\n              //TODO; check is required\n              if (result.data) {\n                if (!isInternal) {\n                  var expiryDate = new Date();\n                  expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n\n                  if (data.privacyConfirmed) {\n                    setPrivacyAccepted(expiryDate);\n                  }\n\n                  if (communicationTypes) {\n                    MarketingCommunicationsService.SetToSeenMarketingForm(data.email, expiryDate);\n                  }\n                }\n\n                resolve(true);\n              } else {\n                resolve(false);\n              }\n            });\n          } else {\n            setValuationData(null);\n            resolve(false);\n          }\n        });\n      });\n      promise.then(function (result) {\n        //do nothing\n        router.push(GetThankYouPageUrl(false, \"valuation\"));\n      })[\"catch\"](function (error) {\n        console.log(error);\n      })[\"finally\"](function () {\n        setIsLoading(false);\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsx(React.Fragment, {\n    children: /*#__PURE__*/_jsxs(Modal, _objectSpread(_objectSpread({\n      onHide: onRequestClose,\n      centered: true\n    }, otherProps), {}, {\n      children: [/*#__PURE__*/_jsx(Modal.Header, {\n        className: \"d-flex flex-nowrap justify-content-center align-items-center\",\n        closeButton: true,\n        children: /*#__PURE__*/_jsx(Modal.Title, {\n          className: \"text-left mb-0\",\n          children: valuationData == null ? \"Value Your Part Exchange\" : \"Your Valuation Is:\"\n        })\n      }), /*#__PURE__*/_jsx(Modal.Body, {\n        className: \"\".concat(style['px']),\n        children: /*#__PURE__*/_jsx(FormContext, _objectSpread(_objectSpread({}, methods), {}, {\n          children: /*#__PURE__*/_jsxs(\"form\", {\n            className: \"px-md-3\",\n            onSubmit: handleSubmit(onSubmit),\n            children: [valuationData == null && /*#__PURE__*/_jsxs(_Fragment, {\n              children: [/*#__PURE__*/_jsxs(\"p\", {\n                className: \"mb-4\",\n                children: [\"We and our partners will give you a fair value for your part-exchange.\", /*#__PURE__*/_jsx(\"br\", {}), \"You can even have it collected for FREE!\"]\n              }), /*#__PURE__*/_jsx(\"p\", {\n                children: \"Simply enter the number plate of the car you'd like a valuation for below.\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"row\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    id: \"yourReg\",\n                    children: /*#__PURE__*/_jsx(\"input\", {\n                      className: \"\".concat(style[\"your-registration\"], \" \").concat(errors.vrm ? style['is-invalid'] : \"\"),\n                      type: \"text\",\n                      placeholder: \"ENTER YOUR REG\",\n                      defaultValue: registration,\n                      maxLength: 10,\n                      name: \"vrm\",\n                      ref: register({\n                        required: true\n                      })\n                    })\n                  }), errors.vrm && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: \"This field is required\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    className: \"form-control \".concat(errors.mileage ? \"is-invalid\" : \"\"),\n                    placeholder: \"Enter Your Current Mileage (required)\",\n                    maxLength: 10,\n                    name: \"mileage\",\n                    ref: register({\n                      required: {\n                        value: true,\n                        message: \"This field is required\"\n                      },\n                      pattern: {\n                        value: /^\\d+$/,\n                        message: \"A valid numeric value is expected\"\n                      }\n                    })\n                  }), errors.mileage && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: (_errors$mileage = errors.mileage) === null || _errors$mileage === void 0 ? void 0 : _errors$mileage.message\n                  })]\n                })]\n              }), /*#__PURE__*/_jsx(\"h3\", {\n                children: \"I'm interested in leasing:\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"row\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Make \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"select\", {\n                    className: \"form-control \".concat(errors.make ? \"is-invalid\" : \"\"),\n                    onChange: function onChange(evt) {\n                      return onMakeSelected(evt);\n                    },\n                    name: \"make\",\n                    ref: register({\n                      required: true\n                    }),\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      value: \"\",\n                      children: \"- Select Make -\"\n                    }), carManufacturerList === null || carManufacturerList === void 0 ? void 0 : carManufacturerList.map(function (make) {\n                      return /*#__PURE__*/_jsx(\"option\", {\n                        value: make.id,\n                        children: make.text\n                      }, make.id);\n                    })]\n                  }), errors.make && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: \"This field is required\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Model \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"select\", {\n                    className: \"form-control \".concat(errors.model ? \"is-invalid\" : \"\"),\n                    name: \"model\",\n                    ref: register({\n                      required: true\n                    }),\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      value: \"\",\n                      children: \"- Select Model -\"\n                    }), modelsList === null || modelsList === void 0 ? void 0 : modelsList.map(function (model) {\n                      return /*#__PURE__*/_jsx(\"option\", {\n                        value: model.id,\n                        children: model.text\n                      }, model.id);\n                    })]\n                  }), errors.model && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: \"This field is required\"\n                  })]\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"row\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Full Name \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    className: \"form-control\",\n                    placeholder: \"Full Name\",\n                    maxLength: 100,\n                    name: \"fullName\",\n                    ref: register({\n                      required: true\n                    })\n                  }), errors.fullName && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: \"This field is required\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Email \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    className: \"form-control \".concat(errors.email ? \"is-invalid\" : \"\"),\n                    placeholder: \"Email\",\n                    maxLength: 70,\n                    name: \"email\",\n                    onBlur: onEmailFocusOut,\n                    ref: register({\n                      required: 'This field is required',\n                      validate: function validate(value) {\n                        return EmailAddressIsValid(value) === true || 'Invalid email address';\n                      }\n                    })\n                  }), errors.email && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: (_errors$email = errors.email) === null || _errors$email === void 0 ? void 0 : _errors$email.message\n                  })]\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"row\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Telephone \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"tel\",\n                    className: \"form-control \".concat(errors.telephone ? \"is-invalid\" : \"\"),\n                    placeholder: \"Telephone\",\n                    maxLength: 50,\n                    name: \"telephone\",\n                    ref: register({\n                      required: 'This field is required',\n                      validate: function validate(value) {\n                        return PhoneNumberIsValid(value) === true || 'Invalid phone number';\n                      }\n                    })\n                  }), errors.telephone && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: (_errors$telephone = errors.telephone) === null || _errors$telephone === void 0 ? void 0 : _errors$telephone.message\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Post Code \", /*#__PURE__*/_jsx(\"span\", {\n                      className: style[\"required\"],\n                      children: \"(Required)\"\n                    })]\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    className: \"form-control \".concat(errors.postCode ? \"is-invalid\" : \"\"),\n                    placeholder: \"Post Code\",\n                    maxLength: 10,\n                    name: \"postCode\",\n                    ref: register({\n                      required: true\n                    })\n                  }), errors.postCode && /*#__PURE__*/_jsx(\"span\", {\n                    className: \"invalid-feedback d-block\",\n                    children: \"This field is required\"\n                  })]\n                })]\n              }), isInternal && /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 col-lg-12 form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Salesperson \"\n                  }), /*#__PURE__*/_jsxs(\"select\", {\n                    className: \"form-control\",\n                    name: \"salesPersonId\",\n                    ref: register(),\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      value: \"\",\n                      children: \"- Select Salesperson -\"\n                    }), salesPeopleList === null || salesPeopleList === void 0 ? void 0 : salesPeopleList.map(function (user) {\n                      return /*#__PURE__*/_jsx(\"option\", {\n                        value: user.id,\n                        children: user.fullName\n                      }, user.id);\n                    })]\n                  })]\n                })\n              }), !isInternal ? /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24\",\n                  children: [/*#__PURE__*/_jsx(MarketingConsent, {\n                    emailAddress: emailAddressConsent,\n                    settings: {\n                      onVerificationStart: function onVerificationStart() {\n                        setMarketingConsentIsVerifying(true);\n                      },\n                      onVerificationComplete: function onVerificationComplete() {\n                        setMarketingConsentIsVerifying(false);\n                      }\n                    }\n                  }), /*#__PURE__*/_jsx(PrivacyPolicyConsent, {})]\n                })\n              }) : null]\n            }), valuationData != null && /*#__PURE__*/_jsx(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"col-24\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: style[\"valuation-result\"],\n                  children: [/*#__PURE__*/_jsx(\"i\", {\n                    className: \"fal fa-gbp\"\n                  }), /*#__PURE__*/_jsx(\"span\", {\n                    dangerouslySetInnerHTML: {\n                      __html: accounting.formatMoney(valuationData.value)\n                    }\n                  })]\n                }), /*#__PURE__*/_jsx(\"p\", {\n                  children: \"This is an approximate value dependant on the condition, exact mileage, service history and other factors. To take this further or accept this please click on the link below.\"\n                }), /*#__PURE__*/_jsx(\"p\", {\n                  children: \"The amount you get may be more or less dependent on the factors mentioned above. Have you been offered more elsewhere? Tell our team!\"\n                })]\n              })\n            })]\n          })\n        }))\n      }), /*#__PURE__*/_jsx(Modal.Footer, {\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"w-100 row\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-24 d-flex justify-content-center justify-content-md-end\",\n            children: [valuationData == null && /*#__PURE__*/_jsx(\"button\", {\n              type: \"button\",\n              className: \"btn btn-primary btn-lg\",\n              onClick: handleSubmit(onSubmit),\n              children: isLoading ? /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                width: \"16\",\n                height: \"16\",\n                icon: faSpinner,\n                className: \"fa-spin\"\n              }) : \"Get Valuation\"\n            }), valuationData != null && /*#__PURE__*/_jsx(\"button\", {\n              type: \"button\",\n              className: \"btn btn-primary btn-lg\",\n              onClick: function onClick(evt) {\n                return handleSearchClick(evt);\n              },\n              children: \"Ready to find a new car?\"\n            })]\n          })\n        })\n      })]\n    }))\n  }); //}\n};\n\nexport default connect(mapStateToProps)(ModalPartExchange);","map":null,"metadata":{},"sourceType":"module"}