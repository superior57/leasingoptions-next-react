{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport { useRouter } from 'next/router';\nimport { useDispatch } from 'react-redux';\nimport Link from 'next/link';\nimport MainLayout from 'components/layout/main-layout';\nimport ModalContext from 'components/HOCs/modal/modalContext';\nimport VehicleBox from 'components/vehicle/vehicle-box';\nimport VehicleInfo from 'components/vehicle/vehicle-info-special-deal';\nimport VehicleShortInfo from 'components/vehicle/vehicle-short-info';\nimport VehicleKeyInfo from 'components/vehicle/vehicle-key-info';\nimport VehicleOptionsTabs from 'components/vehicle/vehicle-options-tabs';\nimport VehicleSummary from 'components/vehicle/vehicle-summary-special-deal';\nimport VehicleQuoteEnquiryModal from 'components/vehicle/vehicle-quote-enquiry-modal';\nimport TrustBox from 'components/trustpilot/trust-box';\nimport VehicleSlideup from 'components/vehicle/vehicle-slideup';\nimport VehicleCountdown from 'components/vehicle/vehicle-countdown';\nimport VehicleImageGalleryTabs from 'components/vehicle/vehicle-image-gallery-tabs';\nimport VehicleFeatures from 'components/vehicle/vehicle-features';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faFire, faHourglassEnd } from '@fortawesome/pro-light-svg-icons';\nimport _ from 'underscore';\nimport { LeasingDealTypes } from 'enums/LeasingDealTypes';\nimport { VehicleTypes } from 'enums/VehicleTypes';\nimport { formatMoney } from 'helpers/currencyHelper';\nimport { SiteSettings } from 'environment/siteSettings';\nimport { GetSpecialDealPricing } from 'business-logic/vehicleService'; //TODO: isHUK, clear page cloudflare cache when countdown completes\n\nvar SpecialDeal = function SpecialDeal(_ref) {\n  var leasingDealType = _ref.leasingDealType,\n      specialDeal = _ref.specialDeal,\n      vehicle = _ref.vehicle,\n      isExpired = _ref.isExpired;\n  var blackFridayTheme = process.env.NEXT_PUBLIC_BLACK_FRIDAY_THEME;\n  var router = useRouter();\n  var dispatch = useDispatch();\n  var modalContext = useContext(ModalContext); //implement maintenanceEnabled\n\n  var maintenanceEnabled = true;\n  var pricesDefaultState = {\n    fullMonthlyPrice: \"Please Call\",\n    initialRental: \"POA\",\n    salesCode: \"POA\",\n    monthlyMaintenancePrice: \"POA\",\n    processingFee: formatMoney(parseFloat(leasingDealType === LeasingDealTypes.Personal ? process.env.NEXT_PUBLIC_PCH_PROC_FEE : process.env.NEXT_PUBLIC_CH_PROC_FEE)),\n    extraOptions: [],\n    extraOptionsTotal: formatMoney(0),\n    p11d: \"N/A\",\n    bikTax: \"-\"\n  };\n\n  var _useState = useState(null),\n      specialDealData = _useState[0],\n      setSpecialDealData = _useState[1];\n\n  var _useState2 = useState(isExpired),\n      isExpiredState = _useState2[0],\n      setIsExpiredState = _useState2[1];\n\n  var _useState3 = useState(false),\n      enquiryAllowed = _useState3[0],\n      setEnquiryAllowed = _useState3[1];\n\n  var _useState4 = useState(false),\n      showCountdown = _useState4[0],\n      setShowCountdown = _useState4[1];\n\n  var _useState5 = useState({\n    vehicleRef: vehicle.vehicleRef,\n    leasingDealType: leasingDealType,\n    term: SiteSettings.DefaultTerm,\n    mileage: SiteSettings.GetDealTypeDefaultMileage(leasingDealType),\n    maintenance: SiteSettings.DefaultMaintenance,\n    initialRentalMonths: SiteSettings.DefaultInitialRentals,\n    options: [],\n    salesCode: 0,\n    ageCategory: null\n  }),\n      customOptions = _useState5[0],\n      setCustomOptions = _useState5[1];\n\n  var _useState6 = useState({\n    term: false,\n    mileage: true,\n    maintenance: false,\n    initialRentalMonths: true\n  }),\n      customOptionsLocks = _useState6[0],\n      setCustomOptionsLocks = _useState6[1];\n\n  var _useState7 = useState(pricesDefaultState),\n      prices = _useState7[0],\n      setPrices = _useState7[1];\n\n  useEffect(function () {\n    dispatch({\n      type: 'UPDATE_OVERLAY_STATE',\n      state: true\n    });\n    GetSpecialDealPricing(specialDeal.id).then(function (result) {\n      var dealData = null;\n\n      if (result.isSucceed && result.data) {\n        dealData = result.data;\n        var term = 4;\n        var maintenance = false;\n\n        if (dealData.prices && dealData.prices.length > 0) {\n          var availableTerms = _.uniq(_.pluck(dealData.prices || [], \"term\"));\n\n          var availableMaintenances = _.uniq(_.pluck(dealData.prices || [], \"maintenance\"));\n\n          if (!_.contains(availableMaintenances, maintenance)) {\n            maintenance = !maintenance;\n          }\n\n          var sortedTerms = _.pluck(_.sortBy(_.filter(dealData.prices || [], function (item) {\n            return item.maintenance === maintenance;\n          }), \"price\"), \"term\");\n\n          if (sortedTerms && sortedTerms.length > 0) {\n            term = sortedTerms[0];\n          }\n\n          setCustomOptionsLocks(function (prevState) {\n            var updatedValues = {\n              term: availableTerms.length !== 3,\n              maintenance: availableMaintenances.length !== 2\n            };\n            return _objectSpread(_objectSpread({}, prevState), updatedValues);\n          });\n        }\n\n        setCustomOptions(function (prevState) {\n          var updatedValues = {\n            term: term,\n            mileage: dealData.mileage,\n            maintenance: maintenance,\n            initialRentalMonths: dealData.rentalMonths\n          };\n          return _objectSpread(_objectSpread({}, prevState), updatedValues);\n        });\n        setSpecialDealData(dealData);\n      }\n\n      if (dealData) {\n        if (dealData.isExpired) {\n          setIsExpiredState(true);\n        } else if (dealData.expiresOn) {\n          setShowCountdown(true);\n        }\n      }\n\n      dispatch({\n        type: 'UPDATE_OVERLAY_STATE',\n        state: false\n      });\n    });\n  }, []);\n  useEffect(function () {\n    var pricesState = _.clone(pricesDefaultState);\n\n    var hasAllowedPrice = false;\n\n    if (customOptions && specialDealData) {\n      var term = customOptions.term;\n      var maintenance = customOptions.maintenance || false;\n      pricesState.processingFee = formatMoney(specialDealData.processingFee);\n\n      var priceItem = _.find(specialDealData.prices || [], function (price) {\n        return price.term === term && price.maintenance === maintenance;\n      });\n\n      if (priceItem) {\n        hasAllowedPrice = priceItem.price && priceItem.price > 0;\n\n        if (hasAllowedPrice) {\n          pricesState.fullMonthlyPrice = priceItem.price ? formatMoney(priceItem.price) : \"Please Call\";\n          pricesState.initialRental = formatMoney(priceItem.initialRental);\n          pricesState.salesCode = formatMoney(0);\n          var maintenancePrice = 0;\n\n          if (maintenance) {\n            var notMaintainedPriceItem = _.find(specialDealData.prices || [], function (price) {\n              return price.term === term && price.maintenance === false;\n            });\n\n            if (notMaintainedPriceItem && notMaintainedPriceItem.price && notMaintainedPriceItem.price > 0 && priceItem.price > notMaintainedPriceItem.price) {\n              maintenancePrice = priceItem.price - notMaintainedPriceItem.price;\n            }\n          }\n\n          pricesState.monthlyMaintenancePrice = formatMoney(maintenancePrice);\n        }\n      }\n    }\n\n    setPrices(pricesState);\n    setEnquiryAllowed(hasAllowedPrice);\n  }, [customOptions, specialDealData]);\n\n  var setOptions = function setOptions(name, value) {\n    if (customOptions[name] !== value) {\n      setCustomOptions(function (prevState) {\n        var updatedValues = {};\n        updatedValues[name] = value;\n        return _objectSpread(_objectSpread({}, prevState), updatedValues);\n      });\n    }\n  };\n\n  var onEnquiryButtonClick = function onEnquiryButtonClick(type) {\n    showEnquiryModal(!isExpiredState && enquiryAllowed, type);\n  };\n\n  var showEnquiryModal = function showEnquiryModal(showAllowed, type) {\n    if (showAllowed && type) {\n      var enquiryData = {\n        dealType: 2,\n        dealId: specialDeal.id,\n        details: \"\".concat(vehicle.make, \" \").concat(vehicle.model, \" \").concat(vehicle.derivative),\n        specialDealId: specialDeal.id,\n        vehicleRef: customOptions.vehicleRef,\n        leasingDealType: customOptions.leasingDealType,\n        term: customOptions.term,\n        mileage: customOptions.mileage,\n        initialRentalMonths: customOptions.initialRentalMonths,\n        maintenance: customOptions.maintenance || false,\n        options: customOptions.options\n      };\n      var enquiryModalOptions = {\n        show: true,\n        title: null,\n        baseData: enquiryData,\n        settings: {\n          isInternal: false,\n          proceededToApplyForFinanceDirectly: false\n        }\n      };\n\n      if (type === \"enquiry\") {\n        enquiryModalOptions.title = \"Enquire Now\";\n      } else if (type === \"order\") {\n        enquiryModalOptions.title = \"Order this \" + (vehicle.vehicleType === VehicleTypes.Commercial ? \"van\" : \"car\");\n        enquiryModalOptions.settings.proceededToApplyForFinanceDirectly = true;\n      }\n\n      if (enquiryModalOptions) {\n        modalContext.showModal(VehicleQuoteEnquiryModal, enquiryModalOptions);\n      }\n    }\n  };\n\n  var onCountdownComplete = function onCountdownComplete() {\n    setIsExpiredState(true); //TODO: clear cloudflare cache\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"container-fluid bg-special-deal \".concat(blackFridayTheme === 'true' ? 'bg-special-deal--bf' : ''),\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"row\",\n        children: [!isExpiredState ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24 \".concat(showCountdown ? \"col-md-12\" : \"\", \" d-md-flex justify-content-start align-items-center py-3\"),\n            children: /*#__PURE__*/_jsxs(\"h1\", {\n              className: \"deal-banner text-white\",\n              children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n                width: \"32\",\n                height: \"32\",\n                icon: faFire\n              }), \" \", specialDeal.headerTitle || \"Special Deal\"]\n            })\n          }), showCountdown ? /*#__PURE__*/_jsx(VehicleCountdown, {\n            bfTheme: blackFridayTheme,\n            deadline: new Date(Date.parse(new Date().toISOString()) + (specialDealData.timeLeft || 0) + 1500),\n            onComplete: onCountdownComplete\n          }) : null]\n        }) : null, isExpiredState ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24 col-sm-6 col-md-8 py-3\",\n            children: /*#__PURE__*/_jsxs(\"h1\", {\n              className: \"deal-banner text-white\",\n              children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n                width: \"32\",\n                height: \"32\",\n                icon: faHourglassEnd\n              }), \" Special Deal Expired\"]\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-24 col-sm-18 col-md-16 d-md-flex justify-content-end align-items-start py-3\",\n            children: [/*#__PURE__*/_jsxs(\"p\", {\n              className: \"mt-3 mt-md-0 mb-md-0 mr-md-3 text-md-right text-white\",\n              children: [\"To see our latest deals, follow us on \", /*#__PURE__*/_jsx(\"a\", {\n                \"aria-label\": \"Facebook\",\n                href: \"https://www.facebook.com/LeasingOptionsLtd\",\n                target: \"_blank\",\n                className: \"text-white\",\n                children: \"Facebook\"\n              }), \", \", /*#__PURE__*/_jsx(\"a\", {\n                \"aria-label\": \"Instagram\",\n                href: \"https://www.instagram.com/leasing_options_ltd/\",\n                target: \"_blank\",\n                className: \"text-white\",\n                children: \"Instagram\"\n              }), \", or \", /*#__PURE__*/_jsx(\"a\", {\n                \"aria-label\": \"Twitter\",\n                href: \"https://twitter.com/LeasingOptions\",\n                target: \"_blank\",\n                className: \"text-white\",\n                children: \"Twitter\"\n              })]\n            }), /*#__PURE__*/_jsx(Link, {\n              passHref: true,\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                className: \"btn btn-outline-light btn-lg\",\n                children: \"Back to homepage\"\n              })\n            })]\n          })]\n        }) : null]\n      })\n    }), /*#__PURE__*/_jsxs(VehicleBox, {\n      isExpiredState: isExpiredState,\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-light-grey\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-24 d-md-none order-1\",\n            children: [/*#__PURE__*/_jsx(VehicleShortInfo, {\n              vehicle: vehicle\n            }), /*#__PURE__*/_jsx(\"hr\", {\n              className: \"my-2 my-md-3\"\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24 order-2 col-lg-12 order-lg-3\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"vehicle-gallery \".concat(blackFridayTheme === 'true' ? 'vehicle-gallery--bf' : '', \" mb-3 mb-md-0\"),\n              children: [/*#__PURE__*/_jsx(VehicleImageGalleryTabs, {\n                vehicleType: vehicle.vehicleType,\n                imageDescription: \"\".concat(vehicle.make, \" \").concat(vehicle.model, \" \").concat(vehicle.derivative),\n                imageUrls: vehicle.imageUrls,\n                interiorUrl: vehicle.interiorUrl,\n                exteriorUrl: vehicle.exteriorUrl\n              }), /*#__PURE__*/_jsx(\"p\", {\n                children: /*#__PURE__*/_jsx(\"small\", {\n                  children: \"Images are for illustration purposes only\"\n                })\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24 order-4 col-lg-12 order-lg-2 d-md-flex mb-3 mb-md-0\",\n            children: /*#__PURE__*/_jsx(VehicleInfo, {\n              vehicle: vehicle,\n              options: {\n                leasingDealType: customOptions.leasingDealType,\n                term: customOptions.term,\n                mileage: customOptions.mileage,\n                maintenance: customOptions.maintenance,\n                initialRentalMonths: customOptions.initialRentalMonths\n              },\n              prices: {\n                initialRental: prices.initialRental,\n                monthlyMaintenance: prices.monthlyMaintenancePrice\n              },\n              settings: {\n                locks: customOptionsLocks,\n                availableMileages: vehicle.availableMileages,\n                hasMaintenance: vehicle.hasMaintenance,\n                maintenanceEnabled: maintenanceEnabled,\n                setOptions: setOptions\n              }\n            })\n          })]\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-special\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-24 col-md-12\",\n            children: [/*#__PURE__*/_jsx(\"h2\", {\n              className: \"h1 mb-5\",\n              children: \"Deal Highlights\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"w-100 bg-white p-3 py-md-4 mb-3 mb-md-0\",\n              dangerouslySetInnerHTML: {\n                __html: specialDeal.dealHighlights\n              }\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-24 col-md-12\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"row no-gutters\",\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-24\",\n                children: /*#__PURE__*/_jsx(VehicleKeyInfo, {\n                  leasingDealType: leasingDealType,\n                  vehicle: vehicle,\n                  prices: {\n                    p11d: vehicle.p11d ? formatMoney(vehicle.p11d) : null,\n                    bikTax: vehicle.bik20Tax && vehicle.bik40Tax ? formatMoney(vehicle.bik20Tax) + \"/\" + formatMoney(vehicle.bik40Tax) + \" p/m\" : null\n                  },\n                  sourceUrl: router.asPath\n                })\n              })\n            }), vehicle.features && vehicle.features.length > 0 ? /*#__PURE__*/_jsx(\"div\", {\n              className: \"row no-gutters\",\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-24\",\n                children: /*#__PURE__*/_jsx(VehicleFeatures, {\n                  features: vehicle.features\n                })\n              })\n            }) : null]\n          })]\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-light-grey\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleSummary, {\n              options: {\n                leasingDealType: customOptions.leasingDealType,\n                term: customOptions.term,\n                mileage: customOptions.mileage,\n                maintenance: customOptions.maintenance,\n                initialRentalMonths: customOptions.initialRentalMonths\n              },\n              prices: {\n                monthly: prices.fullMonthlyPrice,\n                monthlyMaintenance: prices.monthlyMaintenancePrice,\n                processingFee: prices.processingFee\n              },\n              settings: {\n                maintenanceEnabled: maintenanceEnabled\n              }\n            })\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-white\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleOptionsTabs, {\n              vehicleType: vehicle.vehicleType,\n              capId: vehicle.capId,\n              settings: {\n                visibleItems: [\"technical\", \"equipment\"],\n                searchAllowed: false,\n                optionsSelectAllowed: false\n              }\n            })\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"container-fluid py-3 py-md-5 bg-light-grey\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-24\",\n          children: [/*#__PURE__*/_jsx(\"h2\", {\n            children: \"What our customers think\"\n          }), /*#__PURE__*/_jsx(TrustBox, {})]\n        })\n      })\n    }), !isExpiredState ? /*#__PURE__*/_jsx(VehicleSlideup, {\n      leasingDealType: customOptions.leasingDealType,\n      monthlyPrice: prices.fullMonthlyPrice,\n      settings: {\n        isSimpleMode: true,\n        proceedAllowed: enquiryAllowed,\n        onProceed: onEnquiryButtonClick\n      }\n    }) : null]\n  });\n};\n\nSpecialDeal.layout = MainLayout;\nexport var __N_SSP = true;\nexport default SpecialDeal;","map":null,"metadata":{},"sourceType":"module"}