{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport accounting from 'accounting';\nimport { loadStripe } from '@stripe/stripe-js';\nimport style from './checkout-form.module.scss';\nimport Link from 'next/link';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faCreditCard } from \"@fortawesome/pro-regular-svg-icons\";\nimport { faShieldCheck } from \"@fortawesome/pro-regular-svg-icons\";\nimport { faCcApplePay } from \"@fortawesome/free-brands-svg-icons\";\nimport { faCcVisa } from \"@fortawesome/free-brands-svg-icons\";\nimport { faCcMastercard } from \"@fortawesome/free-brands-svg-icons\";\nimport { faLock } from \"@fortawesome/free-solid-svg-icons\";\nimport { faArrowLeft } from \"@fortawesome/free-solid-svg-icons\";\nimport { PaymentsAPI } from 'API/PaymentsAPI';\n\nvar CheckoutForm = function CheckoutForm() {\n  var stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLIC_KEY);\n\n  var _useState = useState(false),\n      succeeded = _useState[0],\n      setSucceeded = _useState[1];\n\n  var _useState2 = useState(false),\n      cancelled = _useState2[0],\n      setCancelled = _useState2[1];\n\n  var _useState3 = useState(null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(false),\n      initializing = _useState4[0],\n      setInitializing = _useState4[1];\n\n  var _useState5 = useState(null),\n      paymentRequired = _useState5[0],\n      setPaymentRequired = _useState5[1];\n\n  var _useState6 = useState(false),\n      isExtension = _useState6[0],\n      setIsExtension = _useState6[1];\n\n  var _useState7 = useState(null),\n      vehicle = _useState7[0],\n      setVehicle = _useState7[1];\n\n  var _useState8 = useState(0),\n      depositAmount = _useState8[0],\n      setDepositAmount = _useState8[1];\n\n  var _useState9 = useState(null),\n      orderNumber = _useState9[0],\n      setOrderNumber = _useState9[1];\n\n  var _useState10 = useState(null),\n      sessionId = _useState10[0],\n      setSessionId = _useState10[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    var queryParams = new URLSearchParams(window.location.search);\n    var paymentSuccess = queryParams.get(\"success\") === \"1\";\n    var paymentCancelled = queryParams.get(\"cancelled\") === \"1\";\n    setSucceeded(paymentSuccess);\n    setCancelled(paymentCancelled);\n\n    if (!paymentCancelled) {\n      var paymentIntentRequest = {\n        orderId: router.query.orderid || queryParams.get(\"orderid\"),\n        type: router.query.type || queryParams.get(\"type\"),\n        amount: parseFloat(router.query.amount || queryParams.get(\"amount\")),\n        extension: (router.query.extension || queryParams.get(\"extension\")) === \"1\",\n        hostOrigin: window.location.href\n      };\n      setInitializing(true); //retrieve checkout session ID\n\n      PaymentsAPI.CreateCheckoutSession(paymentIntentRequest).then(function (result) {\n        if (result.status.code === 0) {\n          if (result.data.uniqueId) {\n            setPaymentRequired(result.data.paymentIsRequired);\n            setIsExtension(result.data.extension);\n            setVehicle(result.data.vehicle);\n            setDepositAmount(result.data.depositAmount);\n            setOrderNumber(result.data.manualOrderId || result.data.orderName);\n            setSessionId(result.data.uniqueId);\n          } else {\n            setError(\"Payment initialization failed.\");\n            setSucceeded(false);\n          }\n\n          setInitializing(false);\n        }\n      });\n    } //Do not show a payment form again\n\n\n    if (paymentSuccess || paymentCancelled) {\n      setPaymentRequired(false);\n    }\n  }, []);\n\n  var handleCheckoutClick = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var stripe, result;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return stripePromise;\n\n            case 2:\n              stripe = _context.sent;\n              _context.next = 5;\n              return stripe.redirectToCheckout({\n                sessionId: sessionId\n              });\n\n            case 5:\n              result = _context.sent;\n\n              if (result.error) {\n                setError(\"Payment Failed. \".concat(result.error.message));\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleCheckoutClick(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"section\", {\n      className: \"\".concat(style[\"payment-header\"]),\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"container text-center\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-md-24 py-md-5\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: style[\"icon\"],\n              children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                icon: faLock,\n                className: \"fa-lock\"\n              })\n            }), /*#__PURE__*/_jsx(\"h1\", {\n              children: \"Secure Online Payment\"\n            })]\n          })\n        })\n      })\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: \"container-fluid py-3\",\n      children: [!initializing && /*#__PURE__*/_jsx(\"div\", {\n        className: \"container py-3 py-md-5\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: style[\"checkout-container\"],\n          children: [succeeded && /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"col-24 text-center\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"d-flex justify-content-center align-items-center \".concat(style[\"title\"]),\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                    icon: faShieldCheck\n                  })\n                }), /*#__PURE__*/_jsx(\"h2\", {\n                  children: \"Thank you for your order\"\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-md-14 col-24 \".concat(style[\"payment-form\"]),\n                  children: [/*#__PURE__*/_jsxs(\"p\", {\n                    children: [\"Your payment reference is: \", /*#__PURE__*/_jsx(\"strong\", {\n                      children: orderNumber\n                    })]\n                  }), /*#__PURE__*/_jsx(Link, {\n                    passHref: true,\n                    href: \"/\",\n                    children: /*#__PURE__*/_jsxs(\"a\", {\n                      className: \"btn btn-primary btn-labeled btn-lg\",\n                      children: [/*#__PURE__*/_jsx(\"span\", {\n                        className: \"btn-label\",\n                        children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                          width: \"17\",\n                          height: \"17\",\n                          icon: faArrowLeft\n                        })\n                      }), /*#__PURE__*/_jsx(\"span\", {\n                        className: \"btn-text\",\n                        children: \"Back to home\"\n                      })]\n                    })\n                  })]\n                })\n              })]\n            })\n          }), cancelled && /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24\",\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"alert alert-warning\",\n                role: \"alert\",\n                children: /*#__PURE__*/_jsx(\"strong\", {\n                  children: \"Your payment was cancelled\"\n                })\n              })\n            })\n          }), !succeeded && !cancelled && /*#__PURE__*/_jsxs(_Fragment, {\n            children: [paymentRequired === true && /*#__PURE__*/_jsxs(_Fragment, {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"col-24 text-center\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"d-flex justify-content-center align-items-center \".concat(style[\"title\"]),\n                    children: [/*#__PURE__*/_jsx(\"div\", {\n                      children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                        icon: faCreditCard\n                      })\n                    }), /*#__PURE__*/_jsx(\"h2\", {\n                      children: \"Payment Checkout\"\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"p\", {\n                    children: [\"A payment of \", /*#__PURE__*/_jsx(\"strong\", {\n                      dangerouslySetInnerHTML: {\n                        __html: accounting.formatMoney(depositAmount, \"&pound;\")\n                      }\n                    }), \"\\xA0is required to enable us to \", isExtension ? \"process your extension\" : \"order the vehicle and progress your order\"]\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: \"row\",\n                    children: /*#__PURE__*/_jsxs(\"div\", {\n                      className: \"col-md-14 col-24 \".concat(style[\"payment-form\"]),\n                      children: [/*#__PURE__*/_jsx(\"p\", {\n                        children: /*#__PURE__*/_jsx(\"strong\", {\n                          children: vehicle\n                        })\n                      }), /*#__PURE__*/_jsxs(\"button\", {\n                        disabled: succeeded,\n                        id: \"submit\",\n                        type: \"submit\",\n                        className: \"btn btn-primary btn-labeled btn-lg btn-block-sm\",\n                        onClick: function onClick(evt) {\n                          handleCheckoutClick(evt);\n                        },\n                        children: [/*#__PURE__*/_jsx(\"span\", {\n                          className: \"btn-label\",\n                          children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                            width: \"17\",\n                            height: \"17\",\n                            icon: faLock\n                          })\n                        }), /*#__PURE__*/_jsxs(\"span\", {\n                          className: \"btn-text\",\n                          children: [\"Pay \", /*#__PURE__*/_jsx(\"strong\", {\n                            dangerouslySetInnerHTML: {\n                              __html: accounting.formatMoney(depositAmount, \"&pound;\")\n                            }\n                          }), \" Now\"]\n                        })]\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: style[\"payment-methods\"],\n                        children: /*#__PURE__*/_jsxs(\"div\", {\n                          className: \"d-flex justify-content-between \".concat(style[\"wrapper\"]),\n                          children: [/*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcApplePay\n                            })\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcVisa\n                            })\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            children: /*#__PURE__*/_jsx(FontAwesomeIcon, {\n                              icon: faCcMastercard\n                            })\n                          })]\n                        })\n                      })]\n                    })\n                  })]\n                })\n              }), error && /*#__PURE__*/_jsx(\"div\", {\n                className: \"row mt-3\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"col-24 col-lg-14\",\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \"alert alert-danger\",\n                    role: \"alert\",\n                    children: error\n                  })\n                })\n              })]\n            }), paymentRequired === false && /*#__PURE__*/_jsx(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"col-24 text-center\",\n                children: [/*#__PURE__*/_jsx(\"h2\", {\n                  children: \"Secure Online payment - No payment required\"\n                }), /*#__PURE__*/_jsx(\"p\", {\n                  children: \"Thanks for your order.\"\n                })]\n              })\n            })]\n          })]\n        })\n      }), initializing && /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 text-center my-5\",\n          children: /*#__PURE__*/_jsx(\"h3\", {\n            children: \"Payment is being initialized. Please wait....\"\n          })\n        })\n      })]\n    })]\n  });\n};\n\nexport default CheckoutForm;","map":null,"metadata":{},"sourceType":"module"}