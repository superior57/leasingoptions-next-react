{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState, useEffect, useContext, useRef } from 'react';\nimport ExpandableText from '../../../components/expandable-text';\nimport CardFeatured from '../../../components/card/card-featured';\nimport CardModel from '../../../components/card/card-model';\nimport CardModelShort from '../../../components/card/card-model-short';\nimport ResultsBlocker from '../../../components/results-blocker';\nimport VehicleCarousel from '../../../components/vehicle-carousel';\nimport DropDown from '../../../components/layout/drop-down';\nimport Pagination from '../../../components/layout/pagination';\nimport Tabs from '../../../components/layout/tabs';\nimport Search from '../../../components/search';\nimport TrustMicro from 'components/trustpilot/trust-micro';\nimport ModalContext from 'components/HOCs/modal/modalContext';\nimport VehiclePricingMatrixModal from 'components/layout/vehicle-pricing-matrix-modal';\nimport VehicleErrorFeedbackModal from 'components/layout/vehicle-pricing-error-feedback-modal';\nimport { LeasingDealTypes } from 'enums/LeasingDealTypes';\nimport { PricingTypes } from 'enums/PricingTypes';\nimport { SearchPanels } from 'enums/SearchPanels';\nimport { TrustThemeTypes } from 'enums/TrustThemeTypes';\nimport { getFeaturedHeaderIcon, getFeaturedHeaderColor, getFeaturedHeaderLabel, GetFriendlyName, isIzmoImage } from 'helpers/helpers';\nimport { capitalize } from 'helpers/stringHelper';\nimport { GetCanonicalUrl, GetVehicleUrl } from 'helpers/urlHelper';\nimport CardWithStickers from 'components/card/card-with-stickers';\nimport { GetVehiclePreviews, GetRecommendedForModel } from 'business-logic/vehicleService';\nimport ReactPlaceholder from 'react-placeholder';\nimport \"react-placeholder/lib/reactPlaceholder.css\";\n\n//TODO: check logic\nvar ShortModelPage = function ShortModelPage(_ref) {\n  var isInternal = _ref.isInternal,\n      leasingDealType = _ref.leasingDealType,\n      vehicleType = _ref.vehicleType,\n      title = _ref.title,\n      description = _ref.description,\n      modelImage = _ref.modelImage,\n      modelGallery = _ref.modelGallery,\n      modelReview = _ref.modelReview,\n      vehicleFilter = _ref.vehicleFilter,\n      make = _ref.make,\n      model = _ref.model,\n      topRecommended = _ref.topRecommended,\n      alternativeModels = _ref.alternativeModels,\n      pricingType = _ref.pricingType,\n      userPostcode = _ref.userPostcode;\n  var resultsRef = useRef(null);\n  var isATC = pricingType == PricingTypes.Atc;\n  var modalContext = useContext(ModalContext);\n  var tabsRef = useRef(null);\n\n  var _useState = useState(modelReview ? 'review' : 'gallery'),\n      activeTab = _useState[0],\n      setActiveTab = _useState[1];\n\n  var _useState2 = useState(1),\n      pageCount = _useState2[0],\n      setPagecount = _useState2[1];\n\n  var _useState3 = useState(12),\n      currentResults = _useState3[0],\n      setCurrentResults = _useState3[1];\n\n  var _useState4 = useState(1),\n      currentPage = _useState4[0],\n      setCurrentPage = _useState4[1];\n\n  var _useState5 = useState(0),\n      totalResults = _useState5[0],\n      setTotalResults = _useState5[1];\n\n  var _useState6 = useState(0),\n      totalVehicles = _useState6[0],\n      setTotalVehicles = _useState6[1];\n\n  var _useState7 = useState('OrderPrice'),\n      sortBy = _useState7[0],\n      setSortBy = _useState7[1];\n\n  var _useState8 = useState('ASC'),\n      sortDirection = _useState8[0],\n      setSortDirection = _useState8[1];\n\n  var _useState9 = useState(topRecommended),\n      topRecommendedData = _useState9[0],\n      setTopRecommendedData = _useState9[1];\n\n  var _useState10 = useState([]),\n      vehiclePreviewsData = _useState10[0],\n      setVehiclesPreviewsData = _useState10[1];\n\n  var _useState11 = useState(true),\n      resultsLoading = _useState11[0],\n      setResultsLoading = _useState11[1];\n\n  useEffect(function () {\n    Promise.resolve(filterTopRecommended(pricingType, userPostcode, vehicleType, leasingDealType, make, model)).then(function (data) {\n      setTopRecommendedData(data.data);\n    });\n  }, [leasingDealType]);\n  useEffect(function () {\n    var paginationCriteria = {\n      pageIndex: currentPage,\n      pageSize: currentResults\n    };\n    var sortingCriteria = {\n      sortBy: sortBy,\n      sortDirection: sortDirection\n    };\n    setResultsLoading(true);\n    GetVehiclePreviews(vehicleFilter, paginationCriteria, sortingCriteria).then(function (data) {\n      setVehiclesPreviewsData(data.data.dataItems);\n      setTotalVehicles(data.data.totalVehiclesCount);\n      setTotalResults(data.data.totalItemsCount);\n      setPagecount(data.data.totalPagesCount);\n      setResultsLoading(false);\n    });\n  }, [leasingDealType, currentPage, currentResults, sortBy, sortDirection]);\n\n  var handleSearchClick = function handleSearchClick() {\n    modalContext.showModal(Search, {\n      show: true,\n      title: \"Start Your Search\",\n      activePanel: SearchPanels.SearchDetailed\n    });\n  };\n\n  var handlePageClick = function handlePageClick(evt, page) {\n    evt.preventDefault();\n    setCurrentPage(page);\n    resultsRef.current.scrollIntoView();\n  };\n\n  var handleSortChange = function handleSortChange(sortBy, sortDirection) {\n    setSortBy(sortBy);\n    setSortDirection(sortDirection);\n  };\n\n  var handleScrollToTabs = function handleScrollToTabs(active) {\n    setActiveTab(active);\n    tabsRef.current.scrollIntoView();\n  };\n\n  var handleActiveTab = function handleActiveTab(key) {\n    return setActiveTab(key);\n  };\n\n  var filterTopRecommended = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(pricingType, userPostcode, vehicleType, dealSelector, make, model) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return GetRecommendedForModel(pricingType, userPostcode, vehicleType, dealSelector, make, model);\n\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function filterTopRecommended(_x, _x2, _x3, _x4, _x5, _x6) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onPricingMatrixButtonClick = function onPricingMatrixButtonClick(vehicle) {\n    if (isInternal) {\n      modalContext.showModal(VehiclePricingMatrixModal, {\n        show: true,\n        vehicleRef: vehicle.vehicleRef,\n        vehicleName: \"\".concat(vehicle.make, \" \").concat(vehicle.model, \" \").concat(vehicle.derivative),\n        pricingType: pricingType || undefined,\n        userPostcode: userPostcode || undefined\n      });\n    }\n  };\n\n  var onErrorFeedbackButtonClick = function onErrorFeedbackButtonClick(vehicle) {\n    if (isInternal) {\n      var _vehicleDetails, _vehicleDetails2, _vehicleDetails3;\n\n      var vehicleDetails = null;\n\n      if (leasingDealType == LeasingDealTypes.Personal) {\n        vehicleDetails = vehicle.personalDeal;\n      } else {\n        vehicleDetails = vehicle.businessDeal;\n      }\n\n      modalContext.showModal(VehicleErrorFeedbackModal, {\n        show: true,\n        vehicleRef: vehicle.vehicleRef,\n        capId: vehicle.capId,\n        vehicleName: \"\".concat(vehicle.make, \" \").concat(vehicle.model, \" \").concat(vehicle.derivative),\n        vehiclePageUrl: GetCanonicalUrl(GetVehicleUrl(isATC, userPostcode, leasingDealType, vehicle.make, vehicle.shortModel, vehicle.model, vehicle.derivative, vehicle.vehicleRef, (_vehicleDetails = vehicleDetails) === null || _vehicleDetails === void 0 ? void 0 : _vehicleDetails.mileage, (_vehicleDetails2 = vehicleDetails) === null || _vehicleDetails2 === void 0 ? void 0 : _vehicleDetails2.initialRentalMonths, (_vehicleDetails3 = vehicleDetails) === null || _vehicleDetails3 === void 0 ? void 0 : _vehicleDetails3.term)),\n        settings: {\n          salespersons: []\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"container-fluid py-3 \".concat(isATC ? \"bg-atc py-md-5\" : \"pt-md-0 pb-md-5\"),\n      children: [isATC && /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 col-md-12 my-3\",\n          children: /*#__PURE__*/_jsx(TrustMicro, {\n            theme: TrustThemeTypes.Dark\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-24 d-flex align-items-center justify-content-between mb-4\",\n          children: [/*#__PURE__*/_jsx(\"h1\", {\n            className: \"text-capitalize m-0\",\n            children: title\n          }), /*#__PURE__*/_jsx(\"img\", {\n            \"data-src\": \"\".concat(process.env.NEXT_PUBLIC_CDN, \"/website/static/makes/\").concat(make.toLowerCase(), \".svg\"),\n            className: \"img-fluid manfacturer-logo lazyload\",\n            alt: \"\".concat(capitalize(GetFriendlyName(make)), \" logo\")\n          })]\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"row\",\n        children: [modelImage && /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 col-md-8 d-none d-md-block\",\n          children: modelImage ? /*#__PURE__*/_jsx(\"img\", {\n            \"data-src\": modelImage,\n            alt: \"\".concat(capitalize(GetFriendlyName(make)), \" \").concat(capitalize(GetFriendlyName(model))),\n            className: \"img-fluid mb-4 mb-md-0 lazyload \".concat(isIzmoImage(modelImage) ? 'izmo-image' : 'nonizmopaddingfix')\n          }) : null\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 \".concat(modelImage ? \"col-md-16\" : \"\"),\n          children: description ? /*#__PURE__*/_jsx(ExpandableText, {\n            theme: isATC ? \"dark\" : \"light\",\n            isATC: isATC,\n            galleryButton: modelGallery && modelGallery.length > 0 ? true : false,\n            reviewButton: modelReview ? true : false,\n            handleScrollToTabs: handleScrollToTabs,\n            children: description\n          }) : null\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(CardWithStickers, {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"container-fluid pt-5 pb-md-5 bg-light-grey\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(ReactPlaceholder, {\n              firstLaunchOnly: true,\n              className: \"mb-3 mb-md-5\",\n              type: \"textRow\",\n              color: \"#E0E0E0\",\n              showLoadingAnimation: true,\n              ready: topRecommendedData.length > 0 ? true : false,\n              rows: 1,\n              children: /*#__PURE__*/_jsxs(\"h3\", {\n                className: \"mb-3 mb-md-5\",\n                children: [/*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalVehicles\n                }), \"  \", LeasingDealTypes[leasingDealType], \" leasing \", /*#__PURE__*/_jsx(\"span\", {\n                  className: \"capitalize\",\n                  children: GetFriendlyName(model)\n                }), \" deals showing\"]\n              })\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleCarousel, {\n              tabletArrows: true,\n              desktopArrows: true,\n              infinite: topRecommendedData.length > 3 ? true : false,\n              children: topRecommendedData === null || topRecommendedData === void 0 ? void 0 : topRecommendedData.map(function (vehicle, index) {\n                return /*#__PURE__*/_jsx(ReactPlaceholder, {\n                  firstLaunchOnly: true,\n                  className: \"pr-3\",\n                  type: \"text\",\n                  showLoadingAnimation: true,\n                  ready: topRecommendedData.length > 0 ? true : false,\n                  rows: 6,\n                  children: /*#__PURE__*/_jsx(CardFeatured, {\n                    id: \"topRecommended-\".concat(vehicle.vehicleRef),\n                    isATC: isATC,\n                    userPostcode: userPostcode,\n                    headerText: getFeaturedHeaderLabel(vehicle.dealType),\n                    headerColor: getFeaturedHeaderColor(vehicle.dealType),\n                    headerIcon: getFeaturedHeaderIcon(vehicle.dealType),\n                    vehicle: vehicle,\n                    dealSelector: leasingDealType\n                  }, \"topRecommended-\".concat(vehicle.vehicleRef, \"-\").concat(index))\n                }, \"topRecommended-\".concat(vehicle.vehicleRef, \"-\").concat(index));\n              })\n            })\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        ref: resultsRef,\n        className: \"w-100 position-relative bg-white py-4 py-md-5\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"container-fluid border-bottom border-light\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-18\",\n              children: /*#__PURE__*/_jsxs(\"h3\", {\n                className: \"mb-4 mb-md-5\",\n                children: [/*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalResults\n                }), \" of \", /*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalVehicles\n                }), \" \", LeasingDealTypes[leasingDealType], \" leasing \", /*#__PURE__*/_jsx(\"span\", {\n                  className: \"capitalize\",\n                  children: GetFriendlyName(model)\n                }), \" deals showing\"]\n              })\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"container-fluid py-3\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-12 col-lg-6\",\n              children: /*#__PURE__*/_jsx(\"button\", {\n                className: \"btn btn-primary btn-lg mb-3 mb-md-0\",\n                onClick: function onClick(evt) {\n                  return handleSearchClick();\n                },\n                children: \"Refine Search\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-12 col-lg-6 offset-lg-12\",\n              children: /*#__PURE__*/_jsxs(DropDown, {\n                indicator: true,\n                active: \"Price Low-High\",\n                wrapperClass: \"w-100\",\n                buttonClass: \"btn-block btn-lg bg-light-grey text-left\",\n                buttonText: \"Sort by\",\n                children: [/*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('OrderPrice', 'DESC');\n                  },\n                  children: \"Price High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('OrderPrice', 'ASC');\n                  },\n                  children: \"Price Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('Seats', 'DESC');\n                  },\n                  children: \"Seats High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('Seats', 'ASC');\n                  },\n                  children: \"Seats Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('EngineSize', 'DESC');\n                  },\n                  children: \"Engine Size High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('EngineSize', 'ASC');\n                  },\n                  children: \"Engine Size Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('Mpg', 'DESC');\n                  },\n                  children: \"MPG High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('Mpg', 'ASC');\n                  },\n                  children: \"MPG Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('CO2', 'DESC');\n                  },\n                  children: \"CO2 High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: function onClick() {\n                    return handleSortChange('CO2', 'ASC');\n                  },\n                  children: \"CO2 Low-High\"\n                })]\n              })\n            })]\n          })\n        }), /*#__PURE__*/_jsx(ResultsBlocker, {\n          resultsLoading: resultsLoading,\n          children: vehiclePreviewsData === null || vehiclePreviewsData === void 0 ? void 0 : vehiclePreviewsData.map(function (vehicle, index) {\n            return /*#__PURE__*/_jsx(\"div\", {\n              className: \"w-100 position-relative \".concat(index % 2 == 0 ? \"bg-white\" : \"bg-light-grey\"),\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"container-fluid\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"row\",\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \"col-24\",\n                    children: /*#__PURE__*/_jsx(ReactPlaceholder, {\n                      type: \"rect\",\n                      firstLaunchOnly: true,\n                      showLoadingAnimation: true,\n                      ready: (vehiclePreviewsData === null || vehiclePreviewsData === void 0 ? void 0 : vehiclePreviewsData.length) > 0 ? true : false,\n                      className: \"my-3\",\n                      color: \"#E0E0E0\",\n                      style: {\n                        height: 225\n                      },\n                      children: /*#__PURE__*/_jsx(CardModel, {\n                        isInternal: isInternal,\n                        pricingType: pricingType,\n                        userPostcode: userPostcode,\n                        vehicle: vehicle,\n                        leasingDealType: leasingDealType,\n                        maintenance: vehicleFilter.maintenance,\n                        settings: {\n                          onErrorFeedback: onErrorFeedbackButtonClick,\n                          onPricingMatrix: onPricingMatrixButtonClick\n                        }\n                      })\n                    })\n                  })\n                })\n              })\n            }, \"card-\".concat(vehicle.vehicleRef, \"-\").concat(index));\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"nav\", {\n        className: \"container-fluid pb-3 pb-md-5 bg-white\",\n        \"aria-label\": \"Pagination\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(Pagination, {\n            className: \"col-md-24 d-flex justify-content-end align-items-center\",\n            totalResults: totalResults,\n            pageCount: pageCount,\n            currentPage: currentPage,\n            handlePageClick: handlePageClick\n          })\n        })\n      }), alternativeModels && alternativeModels.length > 0 ? /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-white\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(\"h2\", {\n              className: \"mb-3 mb-md-5\",\n              children: \"Alternative Models\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleCarousel, {\n              tabletArrows: true,\n              desktopArrows: true,\n              infinite: alternativeModels.length > 3,\n              children: alternativeModels.map(function (item) {\n                return /*#__PURE__*/_jsx(CardModelShort, {\n                  isATC: isATC,\n                  userPostcode: userPostcode,\n                  item: item,\n                  leasingDealType: leasingDealType\n                }, \"alternative-\".concat(item.vehicleRef));\n              })\n            })\n          })\n        })]\n      }) : null]\n    }), modelGallery && modelGallery.length > 0 || modelReview ? /*#__PURE__*/_jsx(\"div\", {\n      ref: tabsRef,\n      id: \"model-review\",\n      className: \"container-fluid py-3 py-md-5 bg-light-grey\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-24\",\n          children: [/*#__PURE__*/_jsxs(\"h3\", {\n            className: \"mb-3 mb-md-5 capitalize\",\n            children: [make + \" \" + GetFriendlyName(model), \" Review\"]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"box bg-white\",\n            children: /*#__PURE__*/_jsx(Tabs, {\n              activeTab: activeTab,\n              handleActiveTab: handleActiveTab,\n              modalTitle: make + \" \" + GetFriendlyName(model),\n              tabOne: modelReview,\n              tabTwo: modelGallery\n            })\n          })]\n        })\n      })\n    }) : null]\n  });\n};\n\nexport default ShortModelPage;","map":null,"metadata":{},"sourceType":"module"}