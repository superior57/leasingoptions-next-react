{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/current_project/PPH/tfs/Website/website/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState, useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport Link from 'next/link';\nimport style from './card-model.module.scss';\nimport Sticker from '../../layout/sticker';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faGasPump, faCog, faTachometerAltFast, faCloud, faExclamationTriangle, faInfoCircle, faEdit, faCheck } from \"@fortawesome/pro-regular-svg-icons\";\nimport { VehicleTypes } from 'enums/VehicleTypes';\nimport { LeasingDealTypes } from 'enums/LeasingDealTypes';\nimport { PricingTypes } from 'enums/PricingTypes';\nimport { formatMoney } from 'helpers/currencyHelper';\nimport { GetMonthlyVATText } from 'helpers/helpers';\nimport { GetDynamicVehicleUrl, GetVehicleUrl } from 'helpers/urlHelper';\nimport { GetDealData } from 'business-logic/vehicleService';\n\nvar CardModel = function CardModel(_ref) {\n  var isInternal = _ref.isInternal,\n      pricingType = _ref.pricingType,\n      userPostcode = _ref.userPostcode,\n      vehicle = _ref.vehicle,\n      leasingDealType = _ref.leasingDealType,\n      maintenance = _ref.maintenance,\n      stickerList = _ref.stickerList,\n      settings = _ref.settings;\n  var isAtc = pricingType && pricingType === PricingTypes.Atc;\n  var initialDeal = leasingDealType === LeasingDealTypes.Personal ? vehicle.personalDeal : vehicle.businessDeal;\n  var vehicleImage = vehicle !== null && vehicle !== void 0 && vehicle.imageUrl ? \"/fit-in/400x400/\" + vehicle.imageUrl : \"/fit-in/400x400/website/static/img-placeholder.jpg\";\n\n  var _useState = useState(false),\n      editToggle = _useState[0],\n      setEditToggle = _useState[1];\n\n  var _useState2 = useState(leasingDealType),\n      editDeal = _useState2[0],\n      setEditDeal = _useState2[1];\n\n  var _useState3 = useState(initialDeal.term * 12),\n      editTerm = _useState3[0],\n      setEditTerm = _useState3[1];\n\n  var _useState4 = useState(initialDeal.mileage),\n      editMileage = _useState4[0],\n      setEditMileage = _useState4[1];\n\n  var _useState5 = useState(initialDeal.initialRentalMonths),\n      editInitial = _useState5[0],\n      setEditInitial = _useState5[1];\n\n  var _useState6 = useState(initialDeal.monthlyPrice),\n      displayedPrice = _useState6[0],\n      setDisplayedPrice = _useState6[1];\n\n  useEffect(function () {\n    var deal = leasingDealType === LeasingDealTypes.Personal ? vehicle.personalDeal : vehicle.businessDeal;\n    setEditDeal(leasingDealType);\n    setEditTerm(deal.term * 12);\n    setEditMileage(deal.mileage);\n    setEditInitial(deal.initialRentalMonths);\n    setDisplayedPrice(deal.monthlyPrice);\n  }, [vehicle, leasingDealType]);\n\n  var handleEditClose = function handleEditClose() {\n    return setEditToggle(false);\n  };\n\n  var handleEditOpen = function handleEditOpen() {\n    return setEditToggle(true);\n  };\n\n  var changeDealType = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(evt) {\n      var selectedValue;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              selectedValue = parseInt(evt.target.value);\n              setEditDeal(selectedValue);\n              updatePrice(editTerm, editMileage, editInitial, selectedValue);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function changeDealType(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var changeTerm = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(evt) {\n      var selectedValue;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              selectedValue = evt.target.value;\n              setEditTerm(selectedValue);\n              updatePrice(selectedValue, editMileage, editInitial, editDeal);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function changeTerm(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var changeMileage = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(evt) {\n      var selectedValue;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              selectedValue = evt.target.value;\n              setEditMileage(selectedValue);\n              updatePrice(editTerm, selectedValue, editInitial, editDeal);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function changeMileage(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var changeInitialRentalMonths = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(evt) {\n      var selectedValue;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              selectedValue = evt.target.value;\n              setEditInitial(selectedValue);\n              updatePrice(editTerm, editMileage, selectedValue, editDeal);\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function changeInitialRentalMonths(_x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var updatePrice = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(term, milage, initialRentalMonths, dealType) {\n      var _dealData$data;\n\n      var dealData;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return GetDealData(vehicle.vehicleRef, term / 12, milage, initialRentalMonths, dealType, maintenance, pricingType, userPostcode);\n\n            case 2:\n              dealData = _context5.sent;\n              setDisplayedPrice(dealData === null || dealData === void 0 ? void 0 : (_dealData$data = dealData.data) === null || _dealData$data === void 0 ? void 0 : _dealData$data.monthlyPrice);\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function updatePrice(_x5, _x6, _x7, _x8) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"\".concat(style['card-model'], \" row d-flex flex-column flex-sm-row flex-wrap my-3 my-md-0\"),\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"col-24 col-sm-6 col-lg-4 pr-md-3 py-md-3 \".concat(style['image']),\n      children: /*#__PURE__*/_jsx(Link, {\n        passHref: true,\n        href: GetDynamicVehicleUrl(isAtc, userPostcode, editDeal),\n        as: GetVehicleUrl(isAtc, userPostcode, editDeal, vehicle.make, vehicle.shortModel, vehicle.model, vehicle.derivative, vehicle.vehicleRef, editMileage, editInitial, editTerm / 12),\n        children: /*#__PURE__*/_jsx(\"a\", {\n          className: \"w-100 d-block text-center text-decoration-none\",\n          children: /*#__PURE__*/_jsx(\"img\", {\n            alt: \"\".concat(vehicle === null || vehicle === void 0 ? void 0 : vehicle.make, \" \").concat(vehicle === null || vehicle === void 0 ? void 0 : vehicle.model, \" \").concat(vehicle === null || vehicle === void 0 ? void 0 : vehicle.derivative),\n            className: \"img-fluid lazyload mb-3 mb-md-0\",\n            \"data-src\": process.env.NEXT_PUBLIC_CDN + vehicleImage\n          })\n        })\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"col-24 col-sm-18 col-lg-12 px-md-3 py-3 pt-lg-1 pb-lg-0 \".concat(style['summary']),\n      children: [/*#__PURE__*/_jsx(Link, {\n        passHref: true,\n        href: GetDynamicVehicleUrl(isAtc, userPostcode, editDeal),\n        as: GetVehicleUrl(isAtc, userPostcode, editDeal, vehicle.make, vehicle.shortModel, vehicle.model, vehicle.derivative, vehicle.vehicleRef, editMileage, editInitial, editTerm / 12),\n        children: /*#__PURE__*/_jsx(\"a\", {\n          className: \"text-decoration-none\",\n          children: /*#__PURE__*/_jsxs(\"h3\", {\n            children: [vehicle === null || vehicle === void 0 ? void 0 : vehicle.make, \" \", vehicle === null || vehicle === void 0 ? void 0 : vehicle.model]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"h4\", {\n        children: vehicle === null || vehicle === void 0 ? void 0 : vehicle.derivative\n      }), vehicle.stickers.length > 0 ? /*#__PURE__*/_jsx(\"div\", {\n        className: style['stickers'],\n        children: vehicle.stickers.map(function (id) {\n          var sticker = stickerList.find(function (item) {\n            return item && item.id === id;\n          });\n          return /*#__PURE__*/_jsx(Sticker, {\n            sticker: sticker\n          }, id);\n        })\n      }) : null, /*#__PURE__*/_jsxs(\"ul\", {\n        className: \"list-inline \".concat(style['options']),\n        children: [/*#__PURE__*/_jsxs(\"li\", {\n          className: \"list-inline-item\",\n          children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n            width: \"25\",\n            height: \"25\",\n            icon: faGasPump\n          }), \" Fuel: \", vehicle === null || vehicle === void 0 ? void 0 : vehicle.fuelType]\n        }), /*#__PURE__*/_jsxs(\"li\", {\n          className: \"list-inline-item\",\n          children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n            width: \"25\",\n            height: \"25\",\n            icon: faCog\n          }), \" Gearbox: \", vehicle === null || vehicle === void 0 ? void 0 : vehicle.gearbox]\n        }), /*#__PURE__*/_jsxs(\"li\", {\n          className: \"list-inline-item\",\n          children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n            width: \"25\",\n            height: \"25\",\n            icon: faTachometerAltFast\n          }), \" MPG: \", vehicle === null || vehicle === void 0 ? void 0 : vehicle.mpg]\n        }), /*#__PURE__*/_jsxs(\"li\", {\n          className: \"list-inline-item\",\n          children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n            width: \"25\",\n            height: \"25\",\n            icon: faCloud\n          }), \" CO2: \", vehicle === null || vehicle === void 0 ? void 0 : vehicle.co2]\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"col-24 col-sm-12 col-lg-4 px-md-3 mt-3 mt-md-0 py-md-3 \".concat(style['info']),\n      children: [/*#__PURE__*/_jsxs(\"p\", {\n        children: [vehicle.vehicleType === VehicleTypes.Commercial ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"mark\", {\n            className: \"mark-text\",\n            children: \"Van\"\n          }), \"\\xA0Lease\"]\n        }) : null, vehicle.vehicleType !== VehicleTypes.Commercial ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"mark\", {\n            className: \"mark-text \".concat(editToggle ? \"d-none\" : \"\"),\n            onClick: handleEditOpen,\n            children: editDeal === LeasingDealTypes.Business ? 'Business' : 'Personal'\n          }), /*#__PURE__*/_jsxs(\"select\", {\n            className: editToggle ? \"\" : \"d-none\",\n            value: editDeal,\n            onChange: function onChange(evt) {\n              return changeDealType(evt);\n            },\n            children: [/*#__PURE__*/_jsx(\"option\", {\n              value: LeasingDealTypes.Business,\n              children: \"Business\"\n            }), /*#__PURE__*/_jsx(\"option\", {\n              value: LeasingDealTypes.Personal,\n              children: \"Personal\"\n            })]\n          }), \"\\xA0Lease\"]\n        }) : null]\n      }), /*#__PURE__*/_jsxs(\"p\", {\n        children: [/*#__PURE__*/_jsx(\"mark\", {\n          className: \"mark-text \".concat(editToggle ? \"d-none\" : \"\"),\n          onClick: handleEditOpen,\n          children: editTerm\n        }), /*#__PURE__*/_jsxs(\"select\", {\n          className: editToggle ? \"\" : \"d-none\",\n          value: editTerm,\n          onChange: function onChange(evt) {\n            return changeTerm(evt);\n          },\n          children: [/*#__PURE__*/_jsx(\"option\", {\n            value: \"24\",\n            children: \"24\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"36\",\n            children: \"36\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"48\",\n            children: \"48\"\n          })]\n        }), \"\\xA0Months Lease\"]\n      }), /*#__PURE__*/_jsxs(\"p\", {\n        children: [/*#__PURE__*/_jsx(\"mark\", {\n          className: \"mark-text \".concat(editToggle ? \"d-none\" : \"\"),\n          onClick: handleEditOpen,\n          children: editMileage\n        }), /*#__PURE__*/_jsxs(\"select\", {\n          className: editToggle ? \"\" : \"d-none\",\n          value: editMileage,\n          onChange: function onChange(evt) {\n            return changeMileage(evt);\n          },\n          children: [/*#__PURE__*/_jsx(\"option\", {\n            value: \"5000\",\n            children: \"5,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"8000\",\n            children: \"8,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"10000\",\n            children: \"10,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"12000\",\n            children: \"12,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"15000\",\n            children: \"15,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"20000\",\n            children: \"20,000\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"30000\",\n            children: \"30,000\"\n          })]\n        }), \"\\xA0Miles Per Annum\"]\n      }), /*#__PURE__*/_jsxs(\"p\", {\n        children: [/*#__PURE__*/_jsx(\"mark\", {\n          className: \"mark-text \".concat(editToggle ? \"d-none\" : \"\"),\n          onClick: handleEditOpen,\n          children: formatMoney(editInitial * displayedPrice)\n        }), /*#__PURE__*/_jsxs(\"select\", {\n          className: editToggle ? \"\" : \"d-none\",\n          value: editInitial,\n          onChange: function onChange(evt) {\n            return changeInitialRentalMonths(evt);\n          },\n          children: [/*#__PURE__*/_jsx(\"option\", {\n            value: \"1\",\n            children: \"1 Month\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"3\",\n            children: \"3 Months\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"6\",\n            children: \"6 Months\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"9\",\n            children: \"9 Months\"\n          }), /*#__PURE__*/_jsx(\"option\", {\n            value: \"12\",\n            children: \"12 Months\"\n          })]\n        }), \"\\xA0Initial Rental\"]\n      }), /*#__PURE__*/_jsx(FontAwesomeIcon, {\n        width: \"25\",\n        height: \"25\",\n        icon: faEdit,\n        onClick: handleEditOpen,\n        className: editToggle ? \"d-none\" : \"\"\n      }), /*#__PURE__*/_jsx(FontAwesomeIcon, {\n        width: \"25\",\n        height: \"25\",\n        icon: faCheck,\n        onClick: handleEditClose,\n        className: editToggle ? \"\" : \"d-none\"\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"col-24 col-sm-12 col-lg-4 pl-md-3 py-md-3 \".concat(style['price']),\n      children: [isInternal ? /*#__PURE__*/_jsxs(\"div\", {\n        className: style['internal'],\n        children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n          width: \"20\",\n          height: \"20\",\n          icon: faExclamationTriangle,\n          title: \"Pricing Matrix\",\n          onClick: function onClick() {\n            return settings.onPricingMatrix(vehicle);\n          }\n        }), /*#__PURE__*/_jsx(FontAwesomeIcon, {\n          width: \"20\",\n          height: \"20\",\n          icon: faInfoCircle,\n          title: \"Report Mistake\",\n          onClick: function onClick() {\n            return settings.onErrorFeedback(vehicle);\n          }\n        })]\n      }) : null, /*#__PURE__*/_jsxs(\"p\", {\n        children: [/*#__PURE__*/_jsx(\"span\", {\n          children: formatMoney(displayedPrice)\n        }), \" \", /*#__PURE__*/_jsx(\"small\", {\n          children: GetMonthlyVATText(editDeal)\n        })]\n      }), /*#__PURE__*/_jsx(Link, {\n        passHref: true,\n        href: GetDynamicVehicleUrl(isAtc, userPostcode, editDeal),\n        as: GetVehicleUrl(isAtc, userPostcode, editDeal, vehicle.make, vehicle.shortModel, vehicle.model, vehicle.derivative, vehicle.vehicleRef, editMileage, editInitial, editTerm / 12),\n        children: /*#__PURE__*/_jsx(\"a\", {\n          className: \"text-decoration-none\",\n          children: /*#__PURE__*/_jsx(\"button\", {\n            className: \"btn btn-primary btn-block btn-lg mt-3 mb-3 mb-lg-0\",\n            children: \"Personalise Deal\"\n          })\n        })\n      })]\n    })]\n  });\n};\n\nfunction mapStateToProps(state) {\n  return {\n    stickerList: state.stickerList\n  };\n}\n\nexport default connect(mapStateToProps)(CardModel);","map":null,"metadata":{},"sourceType":"module"}