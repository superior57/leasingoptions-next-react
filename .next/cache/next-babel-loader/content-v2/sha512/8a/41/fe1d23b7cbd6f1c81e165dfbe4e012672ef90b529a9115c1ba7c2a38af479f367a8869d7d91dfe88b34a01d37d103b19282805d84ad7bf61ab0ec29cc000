{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useEffect, useContext, useRef } from 'react';\nimport ExpandableText from '../../../components/expandable-text';\nimport CardFeatured from '../../../components/card/card-featured';\nimport CardModel from '../../../components/card/card-model';\nimport CardModelShort from '../../../components/card/card-model-short';\nimport ResultsBlocker from '../../../components/results-blocker';\nimport VehicleCarousel from '../../../components/vehicle-carousel';\nimport DropDown from '../../../components/layout/drop-down';\nimport Pagination from '../../../components/layout/pagination';\nimport Tabs from '../../../components/layout/tabs';\nimport Search from '../../../components/search';\nimport TrustMicro from 'components/trustpilot/trust-micro';\nimport ModalContext from 'components/HOCs/modal/modalContext';\nimport VehiclePricingMatrixModal from 'components/layout/vehicle-pricing-matrix-modal';\nimport VehicleErrorFeedbackModal from 'components/layout/vehicle-pricing-error-feedback-modal';\nimport { LeasingDealTypes } from 'enums/LeasingDealTypes';\nimport { PricingTypes } from 'enums/PricingTypes';\nimport { SearchPanels } from 'enums/SearchPanels';\nimport { TrustThemeTypes } from 'enums/TrustThemeTypes';\nimport { getFeaturedHeaderIcon, getFeaturedHeaderColor, getFeaturedHeaderLabel, GetFriendlyName, isIzmoImage } from 'helpers/helpers';\nimport { capitalize } from 'helpers/stringHelper';\nimport { GetCanonicalUrl, GetVehicleUrl } from 'helpers/urlHelper';\nimport CardWithStickers from 'components/card/card-with-stickers';\nimport { GetVehiclePreviews, GetRecommendedForModel } from 'business-logic/vehicleService';\nimport ReactPlaceholder from 'react-placeholder';\nimport \"react-placeholder/lib/reactPlaceholder.css\";\n\n//TODO: check logic\nconst ShortModelPage = ({\n  isInternal,\n  leasingDealType,\n  vehicleType,\n  title,\n  description,\n  modelImage,\n  modelGallery,\n  modelReview,\n  vehicleFilter,\n  make,\n  model,\n  topRecommended,\n  alternativeModels,\n  pricingType,\n  userPostcode\n}) => {\n  const resultsRef = useRef(null);\n  const isATC = pricingType == PricingTypes.Atc;\n  const modalContext = useContext(ModalContext);\n  const tabsRef = useRef(null);\n  const {\n    0: activeTab,\n    1: setActiveTab\n  } = useState(modelReview ? 'review' : 'gallery');\n  const {\n    0: pageCount,\n    1: setPagecount\n  } = useState(1);\n  const {\n    0: currentResults,\n    1: setCurrentResults\n  } = useState(12);\n  const {\n    0: currentPage,\n    1: setCurrentPage\n  } = useState(1);\n  const {\n    0: totalResults,\n    1: setTotalResults\n  } = useState(0);\n  const {\n    0: totalVehicles,\n    1: setTotalVehicles\n  } = useState(0);\n  const {\n    0: sortBy,\n    1: setSortBy\n  } = useState('OrderPrice');\n  const {\n    0: sortDirection,\n    1: setSortDirection\n  } = useState('ASC');\n  const {\n    0: topRecommendedData,\n    1: setTopRecommendedData\n  } = useState(topRecommended);\n  const {\n    0: vehiclePreviewsData,\n    1: setVehiclesPreviewsData\n  } = useState([]);\n  const {\n    0: resultsLoading,\n    1: setResultsLoading\n  } = useState(true);\n  useEffect(() => {\n    Promise.resolve(filterTopRecommended(pricingType, userPostcode, vehicleType, leasingDealType, make, model)).then(function (data) {\n      setTopRecommendedData(data.data);\n    });\n  }, [leasingDealType]);\n  useEffect(() => {\n    const paginationCriteria = {\n      pageIndex: currentPage,\n      pageSize: currentResults\n    };\n    const sortingCriteria = {\n      sortBy: sortBy,\n      sortDirection: sortDirection\n    };\n    setResultsLoading(true);\n    GetVehiclePreviews(vehicleFilter, paginationCriteria, sortingCriteria).then(function (data) {\n      setVehiclesPreviewsData(data.data.dataItems);\n      setTotalVehicles(data.data.totalVehiclesCount);\n      setTotalResults(data.data.totalItemsCount);\n      setPagecount(data.data.totalPagesCount);\n      setResultsLoading(false);\n    });\n  }, [leasingDealType, currentPage, currentResults, sortBy, sortDirection]);\n\n  const handleSearchClick = () => {\n    modalContext.showModal(Search, {\n      show: true,\n      title: \"Start Your Search\",\n      activePanel: SearchPanels.SearchDetailed\n    });\n  };\n\n  const handlePageClick = (evt, page) => {\n    evt.preventDefault();\n    setCurrentPage(page);\n    resultsRef.current.scrollIntoView();\n  };\n\n  const handleSortChange = (sortBy, sortDirection) => {\n    setSortBy(sortBy);\n    setSortDirection(sortDirection);\n  };\n\n  const handleScrollToTabs = active => {\n    setActiveTab(active);\n    tabsRef.current.scrollIntoView();\n  };\n\n  const handleActiveTab = key => setActiveTab(key);\n\n  const filterTopRecommended = async (pricingType, userPostcode, vehicleType, dealSelector, make, model) => {\n    return await GetRecommendedForModel(pricingType, userPostcode, vehicleType, dealSelector, make, model);\n  };\n\n  const onPricingMatrixButtonClick = vehicle => {\n    if (isInternal) {\n      modalContext.showModal(VehiclePricingMatrixModal, {\n        show: true,\n        vehicleRef: vehicle.vehicleRef,\n        vehicleName: `${vehicle.make} ${vehicle.model} ${vehicle.derivative}`,\n        pricingType: pricingType || undefined,\n        userPostcode: userPostcode || undefined\n      });\n    }\n  };\n\n  const onErrorFeedbackButtonClick = vehicle => {\n    if (isInternal) {\n      var _vehicleDetails, _vehicleDetails2, _vehicleDetails3;\n\n      let vehicleDetails = null;\n\n      if (leasingDealType == LeasingDealTypes.Personal) {\n        vehicleDetails = vehicle.personalDeal;\n      } else {\n        vehicleDetails = vehicle.businessDeal;\n      }\n\n      modalContext.showModal(VehicleErrorFeedbackModal, {\n        show: true,\n        vehicleRef: vehicle.vehicleRef,\n        capId: vehicle.capId,\n        vehicleName: `${vehicle.make} ${vehicle.model} ${vehicle.derivative}`,\n        vehiclePageUrl: GetCanonicalUrl(GetVehicleUrl(isATC, userPostcode, leasingDealType, vehicle.make, vehicle.shortModel, vehicle.model, vehicle.derivative, vehicle.vehicleRef, (_vehicleDetails = vehicleDetails) === null || _vehicleDetails === void 0 ? void 0 : _vehicleDetails.mileage, (_vehicleDetails2 = vehicleDetails) === null || _vehicleDetails2 === void 0 ? void 0 : _vehicleDetails2.initialRentalMonths, (_vehicleDetails3 = vehicleDetails) === null || _vehicleDetails3 === void 0 ? void 0 : _vehicleDetails3.term)),\n        settings: {\n          salespersons: []\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: `container-fluid py-3 ${isATC ? \"bg-atc py-md-5\" : \"pt-md-0 pb-md-5\"}`,\n      children: [isATC && /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 col-md-12 my-3\",\n          children: /*#__PURE__*/_jsx(TrustMicro, {\n            theme: TrustThemeTypes.Dark\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-24 d-flex align-items-center justify-content-between mb-4\",\n          children: [/*#__PURE__*/_jsx(\"h1\", {\n            className: \"text-capitalize m-0\",\n            children: title\n          }), /*#__PURE__*/_jsx(\"img\", {\n            \"data-src\": `${process.env.NEXT_PUBLIC_CDN}/website/static/makes/${make.toLowerCase()}.svg`,\n            className: \"img-fluid manfacturer-logo lazyload\",\n            alt: `${capitalize(GetFriendlyName(make))} logo`\n          })]\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"row\",\n        children: [modelImage && /*#__PURE__*/_jsx(\"div\", {\n          className: \"col-24 col-md-8 d-none d-md-block\",\n          children: modelImage ? /*#__PURE__*/_jsx(\"img\", {\n            \"data-src\": modelImage,\n            alt: `${capitalize(GetFriendlyName(make))} ${capitalize(GetFriendlyName(model))}`,\n            className: `img-fluid mb-4 mb-md-0 lazyload ${isIzmoImage(modelImage) ? 'izmo-image' : 'nonizmopaddingfix'}`\n          }) : null\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: `col-24 ${modelImage ? \"col-md-16\" : \"\"}`,\n          children: description ? /*#__PURE__*/_jsx(ExpandableText, {\n            theme: isATC ? \"dark\" : \"light\",\n            isATC: isATC,\n            galleryButton: modelGallery && modelGallery.length > 0 ? true : false,\n            reviewButton: modelReview ? true : false,\n            handleScrollToTabs: handleScrollToTabs,\n            children: description\n          }) : null\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(CardWithStickers, {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"container-fluid pt-5 pb-md-5 bg-light-grey\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(ReactPlaceholder, {\n              firstLaunchOnly: true,\n              className: \"mb-3 mb-md-5\",\n              type: \"textRow\",\n              color: \"#E0E0E0\",\n              showLoadingAnimation: true,\n              ready: topRecommendedData.length > 0 ? true : false,\n              rows: 1,\n              children: /*#__PURE__*/_jsxs(\"h3\", {\n                className: \"mb-3 mb-md-5\",\n                children: [/*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalVehicles\n                }), \"  \", LeasingDealTypes[leasingDealType], \" leasing \", /*#__PURE__*/_jsx(\"span\", {\n                  className: \"capitalize\",\n                  children: GetFriendlyName(model)\n                }), \" deals showing\"]\n              })\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleCarousel, {\n              tabletArrows: true,\n              desktopArrows: true,\n              infinite: topRecommendedData.length > 3 ? true : false,\n              children: topRecommendedData === null || topRecommendedData === void 0 ? void 0 : topRecommendedData.map((vehicle, index) => /*#__PURE__*/_jsx(ReactPlaceholder, {\n                firstLaunchOnly: true,\n                className: \"pr-3\",\n                type: \"text\",\n                showLoadingAnimation: true,\n                ready: topRecommendedData.length > 0 ? true : false,\n                rows: 6,\n                children: /*#__PURE__*/_jsx(CardFeatured, {\n                  id: `topRecommended-${vehicle.vehicleRef}`,\n                  isATC: isATC,\n                  userPostcode: userPostcode,\n                  headerText: getFeaturedHeaderLabel(vehicle.dealType),\n                  headerColor: getFeaturedHeaderColor(vehicle.dealType),\n                  headerIcon: getFeaturedHeaderIcon(vehicle.dealType),\n                  vehicle: vehicle,\n                  dealSelector: leasingDealType\n                }, `topRecommended-${vehicle.vehicleRef}-${index}`)\n              }, `topRecommended-${vehicle.vehicleRef}-${index}`))\n            })\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        ref: resultsRef,\n        className: \"w-100 position-relative bg-white py-4 py-md-5\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"container-fluid border-bottom border-light\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-18\",\n              children: /*#__PURE__*/_jsxs(\"h3\", {\n                className: \"mb-4 mb-md-5\",\n                children: [/*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalResults\n                }), \" of \", /*#__PURE__*/_jsx(\"mark\", {\n                  className: \"mark-text\",\n                  children: totalVehicles\n                }), \" \", LeasingDealTypes[leasingDealType], \" leasing \", /*#__PURE__*/_jsx(\"span\", {\n                  className: \"capitalize\",\n                  children: GetFriendlyName(model)\n                }), \" deals showing\"]\n              })\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"container-fluid py-3\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-12 col-lg-6\",\n              children: /*#__PURE__*/_jsx(\"button\", {\n                className: \"btn btn-primary btn-lg mb-3 mb-md-0\",\n                onClick: evt => handleSearchClick(),\n                children: \"Refine Search\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"col-24 col-md-12 col-lg-6 offset-lg-12\",\n              children: /*#__PURE__*/_jsxs(DropDown, {\n                indicator: true,\n                active: \"Price Low-High\",\n                wrapperClass: \"w-100\",\n                buttonClass: \"btn-block btn-lg bg-light-grey text-left\",\n                buttonText: \"Sort by\",\n                children: [/*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('OrderPrice', 'DESC'),\n                  children: \"Price High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('OrderPrice', 'ASC'),\n                  children: \"Price Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('Seats', 'DESC'),\n                  children: \"Seats High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('Seats', 'ASC'),\n                  children: \"Seats Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('EngineSize', 'DESC'),\n                  children: \"Engine Size High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('EngineSize', 'ASC'),\n                  children: \"Engine Size Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('Mpg', 'DESC'),\n                  children: \"MPG High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('Mpg', 'ASC'),\n                  children: \"MPG Low-High\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('CO2', 'DESC'),\n                  children: \"CO2 High-Low\"\n                }), /*#__PURE__*/_jsx(\"button\", {\n                  type: \"button\",\n                  className: \"text-left\",\n                  onClick: () => handleSortChange('CO2', 'ASC'),\n                  children: \"CO2 Low-High\"\n                })]\n              })\n            })]\n          })\n        }), /*#__PURE__*/_jsx(ResultsBlocker, {\n          resultsLoading: resultsLoading,\n          children: vehiclePreviewsData === null || vehiclePreviewsData === void 0 ? void 0 : vehiclePreviewsData.map((vehicle, index) => /*#__PURE__*/_jsx(\"div\", {\n            className: `w-100 position-relative ${index % 2 == 0 ? \"bg-white\" : \"bg-light-grey\"}`,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"container-fluid\",\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"col-24\",\n                  children: /*#__PURE__*/_jsx(ReactPlaceholder, {\n                    type: \"rect\",\n                    firstLaunchOnly: true,\n                    showLoadingAnimation: true,\n                    ready: (vehiclePreviewsData === null || vehiclePreviewsData === void 0 ? void 0 : vehiclePreviewsData.length) > 0 ? true : false,\n                    className: \"my-3\",\n                    color: \"#E0E0E0\",\n                    style: {\n                      height: 225\n                    },\n                    children: /*#__PURE__*/_jsx(CardModel, {\n                      isInternal: isInternal,\n                      pricingType: pricingType,\n                      userPostcode: userPostcode,\n                      vehicle: vehicle,\n                      leasingDealType: leasingDealType,\n                      maintenance: vehicleFilter.maintenance,\n                      settings: {\n                        onErrorFeedback: onErrorFeedbackButtonClick,\n                        onPricingMatrix: onPricingMatrixButtonClick\n                      }\n                    })\n                  })\n                })\n              })\n            })\n          }, `card-${vehicle.vehicleRef}-${index}`))\n        })]\n      }), /*#__PURE__*/_jsx(\"nav\", {\n        className: \"container-fluid pb-3 pb-md-5 bg-white\",\n        \"aria-label\": \"Pagination\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(Pagination, {\n            className: \"col-md-24 d-flex justify-content-end align-items-center\",\n            totalResults: totalResults,\n            pageCount: pageCount,\n            currentPage: currentPage,\n            handlePageClick: handlePageClick\n          })\n        })\n      }), alternativeModels && alternativeModels.length > 0 ? /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container-fluid py-3 py-md-5 bg-white\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(\"h2\", {\n              className: \"mb-3 mb-md-5\",\n              children: \"Alternative Models\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-24\",\n            children: /*#__PURE__*/_jsx(VehicleCarousel, {\n              tabletArrows: true,\n              desktopArrows: true,\n              infinite: alternativeModels.length > 3,\n              children: alternativeModels.map(item => /*#__PURE__*/_jsx(CardModelShort, {\n                isATC: isATC,\n                userPostcode: userPostcode,\n                item: item,\n                leasingDealType: leasingDealType\n              }, `alternative-${item.vehicleRef}`))\n            })\n          })\n        })]\n      }) : null]\n    }), modelGallery && modelGallery.length > 0 || modelReview ? /*#__PURE__*/_jsx(\"div\", {\n      ref: tabsRef,\n      id: \"model-review\",\n      className: \"container-fluid py-3 py-md-5 bg-light-grey\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-24\",\n          children: [/*#__PURE__*/_jsxs(\"h3\", {\n            className: \"mb-3 mb-md-5 capitalize\",\n            children: [make + \" \" + GetFriendlyName(model), \" Review\"]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"box bg-white\",\n            children: /*#__PURE__*/_jsx(Tabs, {\n              activeTab: activeTab,\n              handleActiveTab: handleActiveTab,\n              modalTitle: make + \" \" + GetFriendlyName(model),\n              tabOne: modelReview,\n              tabTwo: modelGallery\n            })\n          })]\n        })\n      })\n    }) : null]\n  });\n};\n\nexport default ShortModelPage;","map":null,"metadata":{},"sourceType":"module"}